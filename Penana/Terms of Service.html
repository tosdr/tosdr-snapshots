	<!DOCTYPE html>
<html lang="en">
<head><title>Terms of Service - Penana</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width">
<meta http-equiv="content-type" content="text/html;charset=UTF-8">
<meta http-equiv="Cache-control" content="public">
<meta property="fb:app_id" content="736065609814941" />
<meta name="robots" content="NOODP" />
<meta name="csrf-token" content>
<link rel="stylesheet" type="text/css" href="https://assets.penana.com/css/body.1724780054.css" />
<link rel="stylesheet" type="text/css" href="https://assets.penana.com/css/lib.1724780054.css" />
<script src="https://assets.penana.com/js/jquery-3.2.1.min.1501844166.js" type="text/javascript"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@materializecss/materialize@2.1.0/dist/css/materialize.min.css">

<script src="https://cdn.jsdelivr.net/npm/@materializecss/materialize@2.1.0/dist/js/materialize.min.js"></script>
<script src="https://js.stripe.com/v3/"></script>
<script>var stripe =  Stripe('pk_live_Q4Pyh9ts9VcMCct0TdgW1Q9f');</script>
<script type="text/javascript" src="https://cdn.innity.net/admanager.js"></script>
<script async="async" type="text/javascript" src="https://cdn.innity.net/admanager-async.js"></script>
<script> document.documentElement.setAttribute('theme', 'light');</script>
<script type="text/javascript"> 
var innity_adZoneAsync = innity_adZoneAsync || {}; 
innity_adZoneAsync.q = innity_adZoneAsync.q || []; 
</script>
<script type="text/javascript">
  window._taboola = window._taboola || [];
  _taboola.push({article:'auto'});
  !function (e, f, u, i) {
    if (!document.getElementById(i)){
      e.async = 1;
      e.src = u;
      e.id = i;
      f.parentNode.insertBefore(e, f);
    }
  }(document.createElement('script'),
  document.getElementsByTagName('script')[0],
  '//cdn.taboola.com/libtrc/penanahk/loader.js',
  'tb_loader_script');
  if(window.performance && typeof window.performance.mark == 'function')
    {window.performance.mark('tbl_ic');}
</script>
<link rel="stylesheet" type="text/css" href="https://assets.penana.com/css/faq.1724780054.css" />
<link rel="alternate" hreflang="en" href="https://www.penana.com/terms" />
<link rel="alternate" hreflang="zh-TW" href="https://www.penana.com/terms?l=zh" />
<link rel="canonical" href="https://www.penana.com/terms" />
<meta property="og:url" content="https://www.penana.com/terms" />
<link rel="shortcut icon" href="https://static2.penana.com/img/favicon.ico" />
<link rel="apple-touch-icon" href="https://static2.penana.com/img/apple-touch-icon.png">
<script src="https://assets.penana.com/js/lib.1625248118.js" type="text/javascript"></script>
<script src="https://assets.penana.com/js/noty/packaged/jquery.noty.packaged.min.1390242106.js" type="text/javascript"></script>
<script src="https://assets.penana.com/js/main.1722096602.js" type="text/javascript"></script>
<meta property="og:image" content="https://static.penana.com/img/brandimage_en.png">
<meta property="og:image:width" content="875" />
<meta property="og:image:height" content="440" />
<meta name="description" content="Share your fiction works, join writing contests, and read novels online for free!">
<style>
/* Customize the appearance of the tarteaucitron banner */
html #tarteaucitronAlertBig, #tarteaucitron {
    color: #333 !important; /* Dark text color */
}

html #tarteaucitronRoot #tarteaucitronAlertBig{
	background-color: rgba(255, 245, 200, 0.95);
    box-shadow: 0 40px 60px #545454;
}

/* Buttons styling */
#tarteaucitronAlertBig .tarteaucitronAllow, 
#tarteaucitronPersonalizeTab .tarteaucitronAllow, #tarteaucitronAlertBig .tarteaucitronDeny, #tarteaucitronPersonalizeTab .tarteaucitronDeny 
{
    padding: 10px 20px !important; /* Padding for better appearance */
    font-size: 16px !important; /* Larger text size */
    border-radius: 5px !important; /* Rounded corners */
    margin: 5px !important; /* Spacing between buttons */
}

#tarteaucitronAlertBig .tarteaucitronAllow, 
#tarteaucitronPersonalizeTab .tarteaucitronAllow{
    background-color: #ff9800 !important;
    color: #ffffff;
    border: none !important; /* Remove border */
}

#tarteaucitronAlertBig .tarteaucitronDeny, #tarteaucitronPersonalizeTab .tarteaucitronDeny {
    background-color: #f5f5f5 !important;
    color: #333 !important;
    border: 1px solid #ddd !important;
}

html #tarteaucitronAlertBig #tarteaucitronCloseAlert, #tarteaucitronPrivacyUrl{
    background:transparent !important;
    color: #666 !important;
    font-size:14px !important;
}

/* Button hover effect */
#tarteaucitronAlertBig .tarteaucitronAllow:hover, 
#tarteaucitronPersonalizeTab .tarteaucitronAllow:hover{
    background-color: #f57c00 !important; /* Darker button color on hover */
}

#tarteaucitronAlertBig .tarteaucitronDeny:hover, #tarteaucitronPersonalizeTab .tarteaucitronDeny:hover {
    background-color: #e0e0e0 !important; /* Darker button color on hover */
}

/* Customizing text and link color */
#tarteaucitronAlertBig a, #tarteaucitronAlertBig p, #tarteaucitronAlertBig span{
    color: #333 !important; /* Dark text color */
}

#tarteaucitronAlertBig span strong{
    color: #333 !important; /* Dark text color */
    font-weight: normal !important;
    margin-right: 5px;
}

#tarteaucitronAlertBig a {
    text-decoration: underline !important; /* Underline links */
}
</style>
<script type="text/javascript" src="https://assets.penana.com/js/tarteaucitron/tarteaucitron.1721273224.js"></script>
<script type="text/javascript">

        // force English
        window.tarteaucitronForceLanguage = 'en';

        // Initialize consent data
        var consentData = {
            gdprApplies: false,
            hasConsented: {
                'taboola': true,
                'googleanalytics': true,
                'facebook': true            }
        };

        // Define the __cmp function
        window.__cmp = function (command, parameter, callback) {
            switch (command) {
                case 'getConsentData':
                    callback(consentData, true);
                    break;
                case 'ping':
                    callback({ gdprApplies: consentData.gdprApplies, cmpLoaded: true }, true);
                    break;
                case 'getVendorConsents':
                    var vendorConsents = {
                        metadata: 'consent-string-here',
                        gdprApplies: consentData.gdprApplies,
                        hasGlobalScope: false,
                        purposeConsents: {},
                        vendorConsents: consentData.hasConsented
                    };
                    callback(vendorConsents, true);
                    break;
                default:
                    callback({}, false);
            }
        };

        // Function to update consent data
        function updateConsent(vendor, consent) {
            consentData.hasConsented[vendor] = consent;
        }

        // Initialize tarteaucitron.js
        tarteaucitron.init({
            "privacyUrl": "/privacy-policy",
            "hashtag": "#tarteaucitron",
            "cookieName": "tarteaucitron",
            "orientation": "bottom",
            "showAlertSmall": false,
            "showIcon": false,
            "cookieslist": true,
            "adblocker": false,
            "AcceptAllCta": true,
            "highPrivacy": false,
            "handleBrowserDNTRequest": false,
            "removeCredit": true,
            "moreInfoLink": false,
            "useExternalCss": false,
            "readmoreLink": "/privacy-policy",
            "serviceDefaultDescription": "This site uses cookies to improve your experience. You can manage your preferences here.",
            "mandatoryTitle": "Mandatory cookies",
            "mandatoryText": "This site uses cookies necessary for its proper functioning which cannot be deactivated.",
            "serviceDefaultState": true,
            "googleConsentMode": true
        });

        //  "serviceDefaultState": true,


        //"serviceDefaultState": true,
        //"showAlertSmall": true,

        // Define Taboola service (without JS, as the consent affects only personalization)
        tarteaucitron.services.taboola = {
            "key": "taboola",
            "type": "ads",
            "name": "Marketing Cookies",
            "uri": "https://www.taboola.com/privacy-policy",
            "needConsent": true,
            "cookies": ['_taboola'],
            "js": function () {
                updateConsent('taboola', true);
                // Taboola script loaded elsewhere; this affects only personalization
                //console.log("Taboola personalization enabled");
            },
            "fallback": function () {
                updateConsent('taboola', false);
                //console.log("No personalized ads from Taboola");
            }
        };

        tarteaucitron.user.gtagUa = 'UA-49604070-1';
        // tarteaucitron.user.gtagCrossdomain = ['example.com', 'example2.com'];
        tarteaucitron.user.gtagMore = function () { 
            gtag('config', 'G-HPQ96ER7HW');
            gtag('config', 'AW-882302996');

                        
                        
                    };
        (tarteaucitron.job = tarteaucitron.job || []).push('gtag');

       // (tarteaucitron.job = tarteaucitron.job || []).push('googletagmanager');
        

        tarteaucitron.user.facebookpixelId = '394594511078571'; tarteaucitron.user.facebookpixelMore = function () { /* add here your optionnal facebook pixel function */ };
        (tarteaucitron.job = tarteaucitron.job || []).push('facebookpixel');

        (tarteaucitron.job = tarteaucitron.job || []).push('taboola');

                        // show alert even if all consented
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(() => {
                        var element = document.getElementById('tarteaucitronAlertBig');
                        if (element) {
                            element.style.display = 'block';
                            element.style.opacity = '1';
                        } else {
                            //console.error('#tarteaucitronAlertBig element not found');
                        }
                    }, "1000");
                });
        
    </script>
<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!--[if lt IE 9]>
<script src="//css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]-->
<!--[if IE]>
<script type='text/javascript' src='/js/jquery.html5-placeholder-shim.js'></script>
<![endif]-->
<!--[if IE]>
<style type="text/css">
.IEnotice { display:block; }
</style>
<![endif]-->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-49604070-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-49604070-1'); gtag('config', 'G-HPQ96ER7HW');gtag('config', 'AW-882302996');
		
		
		
  function sendevent(action, category, label){
	if (typeof gtag === 'function') {
	  gtag('event', action, {
	    'event_category':category,
	    'event_label':label
	  });	
	}
  }
</script>

<script>
window.fbAsyncInit = function() {
  FB.init({
    appId      : '736065609814941',
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
	//autoLogAppEvents : true,
    xfbml      : true,  // parse social plugins on this page
    version    : 'v6.0' // use version 2.12
  });
  FB.AppEvents.logPageView();
  // Now that we've initialized the JavaScript SDK, we call 
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.
/*
  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });
*/  
  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>
<style>

.ssub1217,.ssub1222 {
    pointer-events: none;
}

.ssub1217 .sub_button,.ssub1222 .sub_button {
	background-color: #aaaaaa;
    position: relative;
}

.ssub1217 .sub_button:after, .ssub1222 .sub_button:after {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    content: "截止訂閱";
    text-align: center;
    color: #ffffff;
    font-weight: bold;
    margin: 30px 0;
} 

		.fixednav #bodywrapper.puremaincenter {
			width: 100%;
		}

		.sidenav{
			top: 50px !important;
		}

		.sidenav li>a{
			font-weight:bold;
		}

		.sidenav li .collapsible-body li a{
			font-weight:normal;
			padding-left: 40px;
		}
		
		.sidenav li .imgleftmenu{
			font-size:14px;
			margin-left:5px;
		}

		.sidenav .second__Header {
			position: absolute;
			top: -50px;
		}

		.sidenav-overlay{
			z-index: 54;
			transition: all ease-out 0.1s;
		}
		
		.sidenav .colfooter{
			margin: 20px 32px;
			line-height: 28px;
		}

		.collapsible-body li.menu-link.active {
			background-color: inherit !important;
		}

		.collapsible-body li.menu-link.active a{
			color: #d9b832 !important;
			font-weight: bold;
		}

		.collapsible-header{
			text-wrap: nowrap;
		}
		
		.collapsible-header > img{
			width:30px;
			margin-right: 3px;
		}
		
		.sidenav li.active>a.collapsible-header{
			background-color: color-mix(in srgb, var(--md-sys-color-secondary) 10%, transparent);
		}

		.sidenav .collapsible-body li.active>a:not(:hover){
			background-color: transparent !important;
		}

		.sidenav::-webkit-scrollbar, .sidenav ::-webkit-scrollbar {
			width: 10px;
		}

		.sidenav ::-webkit-scrollbar {
			display:none;
		}

		.sidenav ::-webkit-scrollbar-thumb, .sidenav::-webkit-scrollbar-thumb {background: #aaaaaa;border-radius: 10px;}

		.sidenav:hover::-webkit-scrollbar, .collapsible-body:hover::-webkit-scrollbar {
			display: block;
		}

		@media only screen and (min-width : 992px) {		  
		  .navopen.fixednav .puremaincenter{
			padding-left:360px !important;
	      }
		  .navopen .puremaincenter.gridarea{
			padding-left:320px !important;
	      }
		  .navopen .puremaincenter.gridarea.wideside{
			padding-left: 480px !important;
			padding-right: 80px !important;
	      }
		}
		
		@media only screen and (max-width : 992px) {
			
		  .second__Header {
			z-index: 98;
		  }
		  
		  html .puremaincenter {
			width: 100% !important;
			min-width:auto !important;
		  }
		  #bodywrapper.gridarea {
			padding: 80px 10px;
		  }		 
		  		  
		  .top-nav{
			position: fixed;
			top: 20px;
			left: 20px;
			color: #504207;
		  }
		  
		  .top-nav i{	  
			color: #504207;
		  }
		  
		  .homeicon{
			  margin-left:10px;
		  }
		  
		  #header{
			  display:none;
		  }
		}
		
		.first__header {
            height: 25px;
            display: flex;
            align-items: center;
            background-color: rgb(247, 247, 247);
            position: sticky;
            top: 0px;
            z-index: 100;
            width: 100%;
            flex: 1;
        }

        .first__header .left {
            position: fixed;
            left: 20%;
        }

        @media (max-width:900px) {
            .first__header .left {
                position: absolute;
                left: 16%;
            }
        }

        .first__header .left .p {
            font-size: small;
            margin-left: 10px;
        }

        .first__header .left .phone {
            border: 1px solid black;
            border-radius: 5px;

        }

        .first__header .header_right img {
            width: 15px;
        }

        .first__header .header_right {
            position: fixed;
            right: 5%;
        }

        @media (max-width:1300px) {
            .first__header .header_right {
                position: fixed;
                right: 50px;
            }
        }

        @media (max-width:900px) {
            .first__header .header_right {
                position: absolute;
                right: 50px;
            }
        }

        .first__header .header_right .p {
            font-size: small;
            margin-left: 10px;
            display: inline;
        }

        .second__Header {
            height: 50px;
            display: flex;
            align-items: center;
            background-color: #ebce58;
			color: #c5992d;
            position: fixed;
            z-index: 100;
            width: 100%;
            flex: 1;
        }

        .second__Header>.nav {
            margin-left: 20px;
			font-size:0;
        }

        .second__Header>.nav>button {
            background-color: #ffcd23;
            border: none;
            cursor: pointer;
        }

        .second__Header>.nav>button>.img {
            width: 25px;
        }

        .second__Header .headerlink{
            margin-left: 10px;
        }

		.second__Header .headertitle{
			color:#795548;
			margin-left:2px;			
		}
		
		.headerlink:hover{
			text-decoration:none;
		}

        .second__Header>.option {
            margin-left: 30px;
            color: #9e7100;
            cursor: pointer;
        }

        @media (max-width:1050px) {
            .second__Header>.option {
                margin-left: 5px;
                color: #9e7100;
                cursor: pointer;
            }
        }

        .second__Header>.option:active {
            color: #604400;
        }

        .second__Header>.header_right {
            display: flex;
            width: 50%;
			height:100%;
            position: absolute;
            right: 20px;
        }
		
		.mobilesearch{
			font-size: 28px;
			margin-right: 10px;
			display:none;
		}
		
		@keyframes delay-overflow {
		  from { overflow: hidden; }
		  to {overflow:visible;}
		}
		
        @media (max-width:600px) {
			.searchform{
				display: flex!important;
				width: 100%;
				height: 0 !important;
				position: fixed !important;
				overflow: hidden;
				top: 50px;
				left: 0;
				border-radius: 0 !important;
				box-shadow:0 1px 5px rgb(91 91 91 / 25%);
			}
			
			.searchform.expand{
				height:35px !important;
				transition: height 0.2s ease;				
				animation: 0.2s delay-overflow;
				animation-fill-mode: forwards;
			}
		}
		
        @media (max-width:900px) {
			.headertitle{
				display:none;
			}
			
            .second__Header>.header_right {
                width: auto;
                flex-grow:1;
				margin-left:115px;
            }
        }

        .second__Header>.header_right>.search {
            flex-grow: 1;
			margin-right: 30px;
			height:70%;
            background-color: white;
            border-radius: 30px;
            display: flex;
			position:relative;
        }
		
		.second__Header>.header_right>.search.active{
			border-radius: 18px 18px 0 0;
		}

        .second__Header>.header_right>.search>input {
            border: none;
            outline: none;
            scroll-behavior: smooth;
            width: 100%;
			height:100%;
			border-radius: 0 30px 30px 0;
        }

        .second__Header>.header_right>.search>select {
            max-height: 20px;
			border-radius:0;
            border-top: none;
            border-bottom: none;
            border-left: none;
            border-right: 1px solid gray;
            margin-left: 8px;
			padding: 0;
			width: auto;
			outline: none;
        }
		
        .second__Header>.header_right>.search>select .second__Header>.search>select,
        input:active {
            border: none;
        }

        .second__Header>.header_right>.search>.searchicon {
            position: relative;
            width: 25px;
            right: 5px;
        }

        @media (max-width:1000px) {
            .second__Header>.header_right>.search>.searchicon {
                position: relative;
                width: 25px;
                right: 5px;
                display: none;
            }
        }

        .optionimg {
            width: 25px;
            margin-left: 25px;
        }

        .third__Header {
            height: 25px;
            display: flex;
            align-items: center;
            background-color: rgb(247, 247, 247);
            position: sticky;
            top: 60px;
            z-index: 99;
            width: 100%;
            flex: 1;
        }

        .third__Header .notification {
            background-color: #FF053A;
            margin-left: 15%;
        }

        @media (max-width:1000px) {
            .third__Header .notification {
                background-color: #FF053A;
                margin-left: 22%;
            }
        }

        @media (max-width:900px) {
            .third__Header .notification {
                background-color: #FF053A;
                margin-left: 17%;
            }
        }

</style>
</head>
<body class="   ">
<div class="displaynone alert_popover">
<div class="alert_wrapper">
<div class="alert_content alert_default">
<span class="close_alert floatright cursorpointer" aria-label="close">&times;</span>
<a class="alert_link" href target="_blank">
<div class="alert_title fontbold"></div>
<div class="alert_body"></div>
</p>
</a>
</div>
</div>
</div>
<div class="second__Header">
<div class="nav">
<div class="menu-icon waves-effect menutopleft sidenav-trigger ga-btn padding9px round" data-target="slide-out" data-event="mobile_topbar" data-cat="leftmenu">
<i class="material-icons ">menu</i>
</div>
</div>
<a href="/home.php" class="valign-wrapper headerlink">
<div class="logo valign-wrapper"><img src="https://static2.penana.com/img/logo_new.svg" height="45px" /></div>
<div class="headertitle"><strong>Penana</strong></div>
</a>
<div class="header_right valign-wrapper">
<i class="material-icons cursorpointer mobilesearch show-on-small">search</i>
<form action="/search.php" method="get" class="search valign-wrapper searchform hide-on-small-only">
<i class="material-icons cursorpointer padding9px">search</i>
<input type="search" name="search" placeholder="Search" class="browser-default searchfield" autocomplete="off" />
<div class="searchsuggestion displaynone alignleft">
<div class="aligncenter">
<div class="sstitle alignleft othersreading displaynone populartags">Popular Tags</div>
<div class="tags_suggest displaynone"></div>
<div class="sstitle alignleft othersreading">What Others Are Reading</div>
<div class="now_reading alignleft"></div>
</div>
</div>
</form>
<script>
$(document).ready(function(e) {	
// interactive search
// functions for search page
function toggleSearch(){
	loadSearchPre();	
	//console.log("toggleSearch");
}

function loadSearchPre(){
	$("form.search").addClass("active");
	$('.searchsuggestion').fadeIn('fast');
	//loadPopularTag();
	loadRecentReads();
}

function loadPopularTag(){
	
	$.ajax({
		type: "POST",
		url: "/ajaxpopulartags.php", // Database name search 
		cache: false,
		success: function(data){
			//console.log('aaa');
			if(data.length > 0){
				
				$(".populartags").show();
				// empty old ones
				$('.tags_suggest').empty();
	
				var suggestJson = JSON.parse(data);
				$.each(suggestJson, function(index, element) {
					$('<a/>', {
						href: "/tag?name="+encodeURIComponent(element.tag_name)+"&from=searchpage",
						html: '<span class="story_tag">'+krEncodeEntities(element.tag_name)+'</span>'
					}).appendTo('.tags_suggest').hide().fadeIn();
				});	
			}
		}
	});	
}

recentRead = "";

function loadRecentReads(){
	
	//console.log('abc');
	
	$.ajax({
		type: "POST",
		url: "/ajaxrecentreads.php", // Database name search 
		cache: false,
		success: function(data){
			//console.log('aab');
			
			if(data == recentRead){
				return false;
			}
			
			recentRead = data;
			
			if(data.length > 0){
				
				// empty old ones
				$('.now_reading').empty();
	
				var suggestJson = JSON.parse(data);
				$.each(suggestJson, function(index, element) {
					
					if(element.book_cover == null || element.book_cover.length==0){
						var storycover = "https://static2.penana.com/img/stories_golden.svg";
						if(element.story_type == "C"){
							var storycover = "https://static2.penana.com/img/contests_golden.svg";
						}
						var iconspecial = "";
					} else {
						var storycover = "https://static2.penana.com/images/books"+element.book_cover;
						var iconspecial = "storyicon";
					}
					
					if(element.story_type == "C"){
						var storytype = "Contest";
					} else if(element.genre_sid > 50){
						var storytype = "Articles";
					} else if(element.subgenre1 == 27 || element.subgenre2 == 27 ){
						var storytype = "Comic";
					} else {
						var storytype = "Story";
					}
					
					$('<a/>', {
						href: "/story.php?id="+element.id+"&from=searchpage",
						class: "ddrow suggestitem fullcover recentreads",
						html: "<span class='suggestlisticon "+iconspecial+"' style='background-image:url("+storycover+")'></span><span class='inlineblock suggestdetails'><div class='suggest_tagname'>"+element.title+'</div><div class="suggestdesc">'+storytype+' · '+element.user_name+'</div></span>'
					}).appendTo('.now_reading').hide().fadeIn();
				});	
				
				// space at bottom
				$('<div/>', {
					class: "padding10px"
				}).appendTo('.now_reading');
				
			}
		}
	});
}

// log click recent read event
$('div').on('click', '.recentreads', function(e) {		
	e.stopPropagation();		
	var url_target = $(this).attr('href');
	sendevent("recentreads", 'desktop', url_target);	
});

// log clicks of search results
$('div').on('click', '.searchresult', function(e) {		
	e.stopPropagation();		
	var url_target = $(this).attr('href');
	sendevent("searchresult", 'desktop', url_target);	
});
	
var img_rootpath = 'https://static2.penana.com';
	
// field value on search field
var searchword = $('.searchfield').val();
	
if(searchword != null && searchword.length>0){
	//toggleSearch(); // jumpy experience
	$('.searchfield').val(searchword);
	setTimeout(function(){ 
		$('.searchfield').trigger("input");
	}, 1);
}

	// on mobile
	$('.mobilesearch').on('click', function(e) {		
		e.stopPropagation();
		e.preventDefault();
		$(".searchform").toggleClass("expand");
	});	
	
// search button
	$('.searchfield').on('focus', function(e) {		
		e.stopPropagation();		
		toggleSearch();
	});
	
	if ($('.searchfield').is(":focus")) {
	  $('.searchfield').focus();
	  //console.log("focused");
	}
	
	//button Dropdown
	$(document).mousedown(function(e) {
		if($(e.target).parents('.searchform').length > 0){
            return true;
        }
		$('.searchsuggestion').hide();	
		$("form.search").removeClass("active");
		/*
		if($(e.target).is('.searchfield') || $(e.target).is('.tags_suggest')){
            e.preventDefault();
            return;
        }
		$('.searchsuggestion').hide();	
		*/
	});	

	function showMagazineData(element, position){									
		if(element.pic == null || element.pic.length==0){
			var storycover = "https://static2.penana.com/img/index/collabs.svg";
			var iconspecial = "";
		} else {
			var storycover = img_rootpath+"/fit-in/200x200/images/plan"+element.pic;
			var iconspecial = "storyicon";
		}
		
		var storytype = 'Magazine';
			
		$('<a/>', {
			id: 'tsg'+element.id,
			class: 'suggestitem ddrow searchresult toinner',
			href: "/magazine/"+element.id,
			html: "<span class='suggestlisticon "+iconspecial+"' style='background-image:url("+storycover+")'></span><span class='inlineblock suggestdetails'><div class='suggest_tagname'>"+element.name+'</div><div class="suggestdesc">'+storytype+'</div></span>'
		}).appendTo(position);
	}

	function showPicksData(element, position){									
		if(element.cover_pic == null || element.cover_pic.length==0){
			var storycover = "https://static2.penana.com/img/index/pick.svg";
			var iconspecial = "";
		} else {
			var storycover = img_rootpath+"/fit-in/90x90/images/banner"+element.cover_pic;
			var iconspecial = "storyicon";
		}
		
		var storytype = 'Reading List';
		
		$('<a/>', {
			id: 'tsg'+element.id,
			class: 'suggestitem ddrow searchresult toinner',
			href: "/storypicks/"+element.id,
			html: "<span class='suggestlisticon "+iconspecial+"' style='background-image:url("+storycover+")'></span><span class='inlineblock suggestdetails'><div class='suggest_tagname'>"+element.name+'</div><div class="suggestdesc">'+storytype+'</div></span>'
		}).appendTo(position);
	}

	var searchprompt = $('.searchsuggestion').html();
	
	$('div,html').on('input', '.searchfield', function(e) {
		 e.stopPropagation();
		 
		recentRead = "";
		 		 	
		var searchfield = $(this);		
		var tag_count = 0;
		var product_count = 0;
		var story_count = 0;
		var user_count = 0;
		var society_count = 0;
		 
		 $('.searchsuggestion').scrollTop(0);
		 
		var val = $(searchfield).val();				
		var dataString = 'return=json&tag='+ val;	
		
		$('.searchword').val(val);	
		
			//var isDivSelected = 0; // indicator for whether pressing [enter] key would 
			//console.log(val);
			//console.log(dataString);
			
			if(val==""){
				$('.searchsuggestion').html(searchprompt);	// load ready page
				loadSearchPre();	
				return false;
			} else {
							
				$.ajax({
					type: "POST",
					url: "/searchsuggest.php", // Database name search 
					data: dataString,
					cache: false,
					success: function(data){
						//console.log(data);
						
						if(val !== $(searchfield).val()){
							return false;
						}						
						
						if(data.length > 0){
							//console.log(data);
							
							// fix bug when backspacing fastly
							var nowvalue =$('.searchfield').val();
							if(nowvalue.length == 0 || nowvalue != val){
								return false;
							}
														
							sendevent('search', 'desktop', val);
										
							$('.searchsuggestion').html('');	
							
							var position = $(".searchsuggestion");
							
							// new data
							var suggestJson = JSON.parse(data);
							$.each(suggestJson, function(index, element) {
								
								//console.log(element);
									
								if(element.type == 'tag'){
							
									if(tag_count < 2){
										var tag_name = element.tag_name;
										var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
																
										// print list of tags
										$('<a/>', {
											id: 'tsg'+element.id,
											class: 'suggestitem ddrow searchresult',
											href: "/tag?name="+encodeURIComponent(tag_name)+"&fromsearch="+val,
											html: '<span class="suggestlisticon tagicon"></span><span class="inlineblock suggestdetails"><div class="suggest_tagname">'+bold_tag_name+'</div><div class="suggestdesc">Popular Tag · '+element.story_count+' Works</div></span>'
										}).appendTo('.searchsuggestion');
									}									
									tag_count++;	
								}  else if(element.type == 'product' || element.type == 'physical_book'){
									
									if(product_count < 3){
										var tag_name = element.name;
										var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
										
										if(element.pic == null || element.pic.length==0){
											var storycover = "https://static.penana.com/img/index/shop.png";
											var iconspecial = "";
										} else {
											var storycover = "https://static.penana.com/images/product"+element.pic;
											var iconspecial = "storyicon";
										}
										
										if(element.type == 'physical_book'){
											var storytype = "Physical Book";
										} else {
											var storytype = "Product";
										}	
										
										var pricing = element.symbol+(element.price/100);
										
										$('<a/>', {
											id: 'tsg'+element.id,
											class: 'suggestitem ddrow searchresult',
											href: "/product.php?id="+element.id,
											html: "<span class='suggestlisticon "+iconspecial+"' style='background-image:url("+storycover+")'></span><span class='inlineblock suggestdetails'><div class='suggest_tagname'>"+bold_tag_name+'</div><div class="suggestdesc">'+storytype+' · '+pricing+'</div></span>'
										}).appendTo('.searchsuggestion');
									}									
									product_count++;	
								} else if(element.type == 'story'){
									
									if(story_count < 3){
										var tag_name = element.title;
										var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
										
										if(element.book_cover == null || element.book_cover.length==0){
											var storycover = "https://static2.penana.com/img/stories_golden.svg";
											if(element.story_type == "C"){
												var storycover = "https://static2.penana.com/img/contests_golden.svg";
											}
											var iconspecial = "";
										} else {
											var storycover = "https://static2.penana.com/images/books"+element.book_cover;
											var iconspecial = "storyicon";
										}
										
										if(element.story_type == "C"){
											var storytype = "Contest";
										} else if(element.genre_sid > 50){
											var storytype = "Articles";
										} else if(element.subgenre1 == 27 || element.subgenre2 == 27 ){
											var storytype = "Comic";
										} else {
											var storytype = "Story";
										}	
										
										$('<a/>', {
											id: 'tsg'+element.id,
											class: 'suggestitem ddrow searchresult',
											href: "/story.php?id="+element.id,
											html: "<span class='suggestlisticon "+iconspecial+"' style='background-image:url("+storycover+")'></span><span class='inlineblock suggestdetails'><div class='suggest_tagname'>"+bold_tag_name+'</div><div class="suggestdesc">'+storytype+' · '+element.user_name+'</div></span>'
										}).appendTo('.searchsuggestion');
									}									
									story_count++;	
								} else if(element.type == 'user'){		

									if(user_count < 2){
										var tag_name = element.user_name;
										var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
												
										if(element.profile_picture == null || element.profile_picture.length==0){
											var useravatar = "https://static.penana.com/img/default.png";
										} else {
											var useravatar = "https://static.penana.com/images/users/large"+element.profile_picture;
										}
												
										// print list of users
										$('<a/>', {
											id: 'tsg'+element.id,
											class: 'suggestitem ddrow searchresult',
											href: "/user/"+element.id+"?fromsearch="+val,
											html: '<span class="suggestlisticon usericon" style="background-image:url('+useravatar+')"></span><span class="inlineblock suggestdetails"><div class="suggest_tagname">'+bold_tag_name+'</div><div class="suggestdesc">Writer · '+element.follow_count+' Followers</div></span>'
										}).appendTo('.searchsuggestion');
									}									
									user_count++;	
								} else if(element.type == 'society'){		

									if(society_count<2){
										var tag_name = element.name;
										var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
												
										if(element.profile_picture == null || element.profile_picture.length==0){
											var societypic = "https://static.penana.com/images/society/default.png";
										} else {
											var societypic = "https://static.penana.com/images/society/large"+element.picture;
										}
												
										// print list of societies
										$('<a/>', {
											id: 'tsg'+element.id,
											class: 'suggestitem ddrow searchresult',
											href: "/society.php?id="+element.id+"&fromsearch="+val,
											html: '<span class="suggestlisticon usericon" style="background-image:url('+societypic+')"></span><span class="inlineblock suggestdetails"><div class="suggest_tagname">'+bold_tag_name+'</div><div class="suggestdesc">Society · '+element.member+' Members</div></span>'
										}).appendTo('.searchsuggestion');
									}									
									society_count++;	
								}else if(element.type == 'magazine'){		

									var tag_name = element.title;
									var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
									
									element.name = bold_tag_name;
									showMagazineData(element, position);									
									
								} else if(element.type == 'picks'){		

									var tag_name = element.list_title;
									var bold_tag_name = tag_name.replace(RegExp(val, 'gi') , '<strong>$&</strong>');
									
									element.name = bold_tag_name;
									showPicksData(element, position);									
									
								}
							});										
						} else {							
							//$('.suggestionfrd').html(data);
						}	
						
						$('<a/>', {
							id: 'searchmore',
							class: 'suggestitem ddrow searchresult',
							href: "/search.php?t=story&search="+val+"&fromsearch="+val,
							html: '<span class="suggestlisticon goldsearchicon"></span><span class="suggestdetails moresearch valign-wrapper">See more results for "<span class="searchword"></span>"</span>'
						}).appendTo('.searchsuggestion');
						$('.searchword').html(val);
						
						// space at bottom
						$('<div/>', {
							class: "padding10px"
						}).appendTo('.searchsuggestion');
						
					}
				});			
			}
	 });
	
});	

</script> 
<div id="loginContainer" class="btnarea" data-ga="login_dropdown" data-cat="header">
<div id="loginButton" class="showbtn valign-wrapper"><span>Login</span><i class="material-icons">arrow_drop_down</i></div>
<div style="clear:both"></div>
<div id="loginBox" class="dropdownbox">
<form action="/login.php" method="post" class="authform ddauthform">
<fieldset class="formbody">
<fieldset>
<label for="emaillogin" class="fontbold active">Email</label>
<i class="material-icons">email</i>
<input type="email" name="email" class="writebox" id="emaillogin" placeholder="Enter your email" required />
</fieldset>
<fieldset>
<label for="passwordlogin" class="fontbold active">Password</label>
<i class="material-icons">lock</i>
<input type="password" name="password" class="writebox" id="passwordlogin" placeholder="Enter your password" required />
</fieldset>
<fieldset>
<label for="checkboxhead" class="toulabel">
<input type="checkbox" id="checkboxhead" class="checkbox" name="rmbme" value="1" checked />
<span id="rmbme">Remember me</span>
<div id="forgetbtn" class="margintop5px"><a href="/forgot_password.php">Forgot your password?</a></div>
</label>
<input type="submit" class="authbutton" value="Sign in" />
</fieldset>
<input type="hidden" name="redirurl" value="/terms" />
<div class="aligncenter">OR<br>
<span class="fblogin fblogin_small">
<img class="floatleft fbIcon" src="https://static2.penana.com/img/log/facebook_blue.png" width="25px" height="25px">
<span class="fblogintxt">Login with Facebook</span>
</span>
</div>
</fieldset>
</form>
</div>
</div>


<div id="RegContainer" class="btnarea" data-ga="reg_dropdown" data-cat="header">
<div id="RegButton" class="showbtn valign-wrapper"><span>Register</span><i class="material-icons">arrow_drop_down</i><em></em></div>
<div style="clear:both"></div>
<div id="RegBox" class="dropdownbox">
<form action="/register.php" method="post" class="authform ddauthform">
<fieldset class="formbody">
<fieldset>
<label for="user_namereg" class="fontbold active">Pen Name</label>
<i class="material-icons">edit</i>
<input type="text" name="user_name" class="writebox" id="user_namereg" placeholder="Enter your pen name" required />
</fieldset>
<fieldset>
<label for="emailreg" class="fontbold active">Email</label>
<i class="material-icons">email</i>
<input type="email" name="email" class="writebox" id="emailreg" placeholder="Enter your email" required />
</fieldset>
<fieldset>
<label for="passwordreg" class="fontbold active">Password</label>
<i class="material-icons">lock</i>
<input type="password" name="password" class="writebox" id="passwordreg" placeholder="Enter your password" required />
</fieldset>
<fieldset>
<input type="checkbox" name="terms" class="floatleft" style="position: absolute;top: -2000px;" />
<input type="hidden" name="dum" value />
<input type="hidden" name="time" value="1726004813" />
<label class="toulabel">
<input type="checkbox" name="tou" class="checkbox" required />
<span class="tou toptou">I have read, understand, and agree to the Penana <a href="/terms.php" target="_blank">Terms of Service</a>.</span>
</label>
<input type="submit" id="register" class="authbutton" value="Register" />
</fieldset>
<input type="hidden" name="redirurl" value="/terms" />
<div class="aligncenter">OR<br>
<span class="fblogin fblogin_small">
<img class="floatleft fbIcon" src="https://static2.penana.com/img/log/facebook_blue.png" width="25px" height="25px">
<span class="fblogintxt">Login with Facebook</span>
</span>
</div>
</fieldset>
</form>
</div>
</div>

</div>
</div>
<div class="headnotice IEnotice displaynone">Please use Chrome or Firefox for better user experience!</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<ul id="slide-out" class="sidenav thbox2  manager-menu" style="z-index: 99;">
<div class="second__Header">
<div class="nav">
<div class="menu-icon waves-effect menutopleft sidenav-close ga-btn">
<i class="material-icons ">menu</i>
</div>
</div>
<div class="logo"><a href="/home.php" class="valign-wrapper"><img src="https://static2.penana.com/img/logo_new.svg" height="45px" /></a></div>
</div>
<li class="no-padding">
<ul class="collapsible collapsible-accordion">
<li class="menusubtitle">Discover</li>
<li class="backhome menu-link">
<a href="/home" class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/home.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Home</span>
</a>
<div class="collapsible-body"></div>
</li>
<li class="stories_menu">
<a class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/stories.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Stories</span>
</a>
<div class="collapsible-body thbox">
<ul>
<li class="menu-link all">
<a href="/stories?genre=all" data-title="All">All</a>
</li>
<li class="menu-link Adventure">
<a href="/stories?genre=Adventure" data-title="Adventure">Adventure</a>
</li>
<li class="menu-link Children">
<a href="/stories?genre=Children" data-title="Children">Children</a>
</li>
<li class="menu-link Comedy">
<a href="/stories?genre=Comedy" data-title="Comedy">Comedy</a>
</li>
<li class="menu-link Drama">
<a href="/stories?genre=Drama" data-title="Drama">Drama</a>
</li>
<li class="menu-link Fantasy">
<a href="/stories?genre=Fantasy" data-title="Fantasy">Fantasy</a>
</li>
<li class="menu-link Horror">
<a href="/stories?genre=Horror" data-title="Horror">Horror</a>
</li>
<li class="menu-link Romance">
<a href="/stories?genre=Romance" data-title="Romance">Romance</a>
</li>
<li class="menu-link Sci-Fiction">
<a href="/stories?genre=Sci-Fiction" data-title="Sci-Fiction">Sci-Fiction</a>
</li>
<li class="menu-link Suspense">
<a href="/stories?genre=Suspense" data-title="Suspense">Suspense</a>
</li>
<li class="menu-link Wuxia">
<a href="/stories?genre=Wuxia" data-title="Wuxia">Wuxia</a>
</li>
<li class="menu-link Historical">
<a href="/stories?genre=Historical" data-title="Historical">Historical</a>
</li>
<li class="menu-link Supernatural">
<a href="/stories?genre=Supernatural" data-title="Supernatural">Supernatural</a>
</li>
<li class="menu-link YoungAdult">
<a href="/stories?genre=Young Adult" data-title="Young Adult">Young Adult</a>
</li>
<li class="menu-link Screenplay">
<a href="/stories?genre=Screenplay" data-title="Screenplay">Screenplay</a>
</li>
<li class="menu-link Action">
<a href="/stories?genre=Action" data-title="Action">Action</a>
</li>
<li class="menu-link General">
<a href="/stories?genre=General" data-title="General">General</a>
</li>
</ul>
</div>
</li>
<li class>
<a class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/articles.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Short pieces</span>
</a>
<div class="collapsible-body thbox">
<ul>
<li class="menu-link articles">
<a href="/articles" class="font0px noformatlink" data-title="Short pieces">
<span class="imgleftmenu verticalmiddle">All</span>
</a>
</li>
<li class="menu-link shortstories">
<a href="/articles?gc=shortstories" class="font0px noformatlink" data-title="Short stories">
<span class="imgleftmenu verticalmiddle">Short stories</span>
</a>
</li>
<li class="menu-link journals">
<a href="/articles?gc=journals" class="font0px noformatlink" data-title="Journals & Memoirs">
<span class="imgleftmenu verticalmiddle">Journals & Memoirs</span>
</a>
</li>
<li class="menu-link commentaries">
<a href="/articles?gc=commentaries" class="font0px noformatlink" data-title="Commentaries">
<span class="imgleftmenu verticalmiddle">Commentaries</span>
</a>
</li>
<li class="menu-link poems">
<a href="/articles?gc=poems" class="font0px noformatlink" data-title="Poems & Lyrics">
<span class="imgleftmenu verticalmiddle">Poems & Lyrics</span>
</a>
</li>
</ul>
</div>
</li>
<li>
<a class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/contests.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Contests</span>
</a>
<div class="collapsible-body thbox">
<ul>
<li class="menu-link contest"><a class="noformatlink" href="/contests.php">Trending</a></li>
<li class="menu-link endsoon"><a class="noformatlink" href="/contests.php?cat=endsoon">Ending Soon</a></li>
<li class="menu-link latest"><a class="noformatlink" href="/contests.php?cat=latest">New Contests</a></li>
<li class="menu-link completed"><a class="noformatlink" href="/contests.php?cat=completed">Completed</a></li>
</ul>
</div>
</li>
<li>
<a class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/charts.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Charts</span>
</a>
<div class="collapsible-body thbox">
<ul>
<li class="menu-link donate"><a class="noformatlink" href="/chart.php?order=donate">Most Donated</a></li>
<li class="menu-link update_request"><a class="noformatlink" href="/chart.php?order=update_request">Most Update Requests</a></li>
<li class="menu-link purchase_cumulative"><a class="noformatlink" href="/chart.php?order=purchase_cumulative">Highest Grossing</a></li>
<li class="menu-link read"><a class="noformatlink" href="/chart.php?order=read">Most Read</a></li>
<li class="menu-link like"><a class="noformatlink" href="/chart.php?order=like">Most Liked</a></li>
<li class="menu-link comment"><a class="noformatlink" href="/chart.php?order=comment">Most Commented</a></li>
<li class="menu-link writers"><a class="noformatlink" href="/chart.php?order=writers">Writers</a></li>
</ul>
</div>
</li>
<li class="menusubtitle">Me</li>
<li class="menu-link bookshelf">
<a href="/bookshelf" class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/bookmark.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Bookshelf</span>
</a>
<div class="collapsible-body"></div>
</li>
<li class="menu-link newstory_menu">
<a onclick="login_popup();return false;" class="collapsible-header noformatlink font0px" onclick="login_popup();return false;">
<img src="https://static2.penana.com/img/menu/compose.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">Write</span>
</a>
<div class="collapsible-body"></div>
</li>
<li class="menu-link sogrid">
<a onclick="login_popup();return false;" class="collapsible-header noformatlink font0px" onclick="login_popup();return false;">
<img src="https://static2.penana.com/img/menu/society.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">
Society <span class="menucount"></span>
</span>
</a>
<div class="collapsible-body"></div>
</li>
<li class="menu-link hub">
<a onclick="login_popup();return false;" class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/hub.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">
Hub <span class="menucount"></span>
</span>
</a>
<div class="collapsible-body"></div>
</li>
<li class=" publishlink">
<a href="https://penana-1.gitbook.io/penana-guide" target="_blank" class="collapsible-header noformatlink font0px">
<img src="https://static2.penana.com/img/menu/rocket.svg" class="verticalmiddle">
<span class="imgleftmenu verticalmiddle">
How to Publish
</span>
</a>
<div class="collapsible-body"></div>
</li>
<div class="colfooter">
<div>
<a href="/privacy.php">Privacy</a> · <a href="/terms.php">Terms</a> · <a href="/faq.php">FAQ</a> · <a href="/feedback.php">Feedback</a><br><a href class="langsetting"><i class="material-icons">language</i>Language settings</a> · <a href="https://m.penana.com/terms?v=mobile" class="mobbtn">Mobile view</a><br>
</div>
<div>Penana © 2024</div>
</div> </ul>
</li>
</ul><script> 
var ajax=null; //our ajax call instance

$("html, div").on("click", ".sidenav-trigger", function(e){
	e.stopPropagation();
	
	var elem = document.querySelector(".sidenav");
    var instance = M.Sidenav.getInstance(elem);
	
	if(instance.isOpen){
		instance.close();
		$("body").removeClass("navopen");
	} else {
		instance.open();
		$("body").addClass("navopen");
	}
	
	flowXBoxes();
	fixXBoxes();
	
	$(".scroll_menu").trigger("custom-scroll");
		
});

// manager menu
$("html").on("click", ".menu-link", function(e){
	e.stopPropagation();
	e.preventDefault();
	
	$(".menu-link").removeClass("active");
	$(this).addClass("active");
		
	var active_class = $(this).find("a").attr("active-class");
	if(typeof active_class != 'undefined'){
		$(".menu-link."+active_class).addClass("active");
	} 
	
	var url = $(this).find("a").attr("href");
	var title = $(this).find("a").attr("data-title");
	if(typeof title == 'undefined'){
		var title = $(this).text();
	} 
		
	var rep = $(this).attr("data-div");
	var nowrapclass = $(this).attr("nowrap");		
	var loadinside = $(this).attr("load-inside");		
	var loadurl = $(this).attr("load-url");		
		
	if(typeof rep !== 'undefined' && rep !==0){
		var replacediv = $("."+rep);
	} else {
		var replacediv = $(".replacearea");
	}
	
	if($(replacediv).length){
		if(typeof title == 'undefined'){
			title = null;		
		} else {
			title = title+' | Penana';
			document.title = title;
		}
		window.history.pushState({}, title, url);
		
		url = url.replace(/^\/+/, '');
		
		if(url.indexOf('?') > -1){
			var concat = "&";		
		} else {
			var concat = "?";	
		}
			
		if(typeof nowrapclass !== 'undefined' && nowrapclass !==0){
			url = url+concat+"nowrapclass=1";
		}
		if(typeof loadurl !== 'undefined' && loadurl !==""){
			$(".gridarea").attr("load-url", loadurl);
		}
		$(replacediv).html("<p class='loadingp'>loading...</p>");
						
		 if (ajax!=null){
			ajax.abort();
		 }
		 
		ajax=ajax=$.get('/load_'+url, function(data){
			if(typeof loadinside !== 'undefined' && loadinside !==0){
				$(replacediv).html(data);
			} else {
				$(replacediv).replaceWith(data);
			}
			$(".scroll_menu").trigger("custom-scroll");
			setTimeout(function(){ $(".scroll_menu").trigger("custom-scroll"); }, 500);
			dragscroll.reset();
			timing = 'good';
			page = 2;
		});
	} else {
		window.location.href = url;
	}
});

	//preopen collapsible sections
	
	
		
	document.addEventListener('DOMContentLoaded', function() {
		var elems = document.querySelectorAll('.collapsible');
		var instances = M.Collapsible.init(elems, {
		// specify options here
		});
	});
          
	var elems = document.querySelectorAll('.sidenav');
    var instances = M.Sidenav.init(elems, {
		// options here
	});

	  function updateMyCount(){
		  		  
		  $.get("/ajax_my_counts.php",
				{ 
				},
			function(data,status){				
				if(data !== ""){
					
					var obj = JSON.parse(data);
					
					//console.log(data);
					
					// total red num
					if(obj.total_n >0){
						$('.menubutton .numofmes').html(obj.total_n);
					} else {
						$('.menubutton .numofmes').html("");
					}
					
					// total message
					if(obj.message >0){
						$('.mailbutton').addClass('blink').find('.numofmes').html(obj.message);
					} else {
						$('.mailbutton').removeClass('blink').find('.numofmes').html("");
					}
					
					// total notifications
					if(obj.noti_request >0){
						$('.alertbutton').addClass('blink').find('.numofmes').html(obj.noti_request);
					} else {
						$('.alertbutton').removeClass('blink').find('.numofmes').html("");
					}
					
					// total bm
					if(obj.bookmark >0){
						$('.bookmarkbutton').addClass('blink').find('.numofmes').html(obj.bookmark);
					} else {
						$('.bookmarkbutton').removeClass('blink').find('.numofmes').html("");
					}
					
					// total soc
					if(obj.soc >0){
						if(obj.soc > 9){
							obj.soc = "9+";
						}
						$('.sogrid').find('.menucount').html(obj.soc);
					} else {
						$('.sogrid').find('.menucount').html("");
					}
					
					// total hub
					if(obj.hub >0){
						if(obj.hub > 9){
							obj.hub = "9+";
						}
						$('.hub').find('.menucount').html(obj.hub);
					} else {
						$('.hub').find('.menucount').html("");
					}
					
					// coin balance
					if(obj.coin_balance > 0){
						$(".my_current_coin_balance").html(obj.coin_balance);
					}
				}
			});
	  }
	  
	  updateMyCount();

function krEncodeEntities(s){
	return $("<div/>").text(s).html();
}

function hasFormValidation() {
	return 'reportValidity' in document.createElement('form');
};				
 
$(document).ready(function(){
			
	var csrf = $('meta[name="csrf-token"]').attr('content');
		
	$('.reconfirm').click(function(){
	 $('.reconfirm').hide();
	 $.post("/reconfirm.php",
		{ 
		  action_token:csrf
		},
		function(data,status){
			console.log(data);
		});
	});	

  $("div").on('click', '.accept',function(){  
    var $this = $(this);
	var id = this.id;
	var numofmes = $this.closest('.btnarea').find('.numofmes').html();
	var nplace = $this.closest('.btnarea').find('.numofmes');
	var btnarea = $this.closest('.btnarea');
    $.post("/process.php",
    { id: id ,
      action:"acceptrequest",
	  action_token:csrf
    },
    function(data,status){
      $("#ha"+id).html(data);
	  numofmes--;
	  if(numofmes<0){
		numofmes = 0;
	  }
	  if (numofmes==0){
		nplace.css("display", "none");
		btnarea.removeClass("blink");
	  }
	  nplace.html(numofmes);
    });
  });
  
   $("div").on('click', '.decline',function(){  
    var $this = $(this);
	var id = this.id;
	var numofmes = $this.closest('.btnarea').find('.numofmes').html();
	var nplace = $this.closest('.btnarea').find('.numofmes');
	var btnarea = $this.closest('.btnarea');
    $.post("/process.php",
    { id: id ,
      action:"rejectrequest",
	  action_token:csrf
    },
    function(data,status){
      $("#ha"+id).html(data);
	  numofmes--;
	  if (numofmes==0){
		nplace.css("display", "none");
		btnarea.removeClass("blink");
	  }
	  nplace.html(numofmes);
    });
  });  
  
  // Display Language 
   $(".display_language").click(function(e){ 
	var language = this.id;
	 setCookie("display_language",language,365);
	 location.reload();	
  });
  
  // ajax load notification
  $('ul').on('click', '.alertbutton', function(e){
	   //console.log('bb');
	  $('.noti3').load('/load3noti.php');
	  $('.request3').load('/load3request.php');
  });
  
  // ajax load message
  $('ul').on('click', '.mailbutton', function(e){
	  //console.log('aa');
	  $('.message3').load('/load3message.php');
  });

  // ajax load new bookmark
  $('ul').on('click', '.bookmarkbutton', function(e){
	  //console.log('aa');
	  $('.bookmark5').load('/load5bookmark.php');
  });
  
});

//js_string
var str_like = "Like!";
var str_unlike = "Unlike!";

var str_follow = "+Follow";
var str_unfollow = "Unfollow";

var yestxt = 'Yes';
var canceltxt = 'Cancel';

</script>
<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    //console.log('statusChangeCallback');
    //console.log(response);
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    if (response.status === 'connected') {
		  // Logged into your app and Facebook.
		 // testAPI();
			$.ajax({
				url: '/fblogin-callback.php',
				type: 'POST',
				success: function(data) {
				  //console.log(data);
				  if(data == 'mergefb'){					  
					  confirm_prompt("You have already had a Penana account with this email. Are you sure you want to add Facebook Login to your account?", function(yes) {
						if (yes){
							$.post("/fblogin-callback.php",
							{ mergefb: 1,
							  action_token: csrf
							},
							function(data,status){
								//console.log(data);
								window.location.reload(false); 
							});
						}
					});
				  } else if(data == 'noemail'){
					  input_prompt("Please enter your email address.", function(data) {
						if (data){
							//console.log(data);
							email = data;
							$.post("/fblogin-callback.php",
							{ fbloginemail: 1,
							  email: email,
							  action_token: csrf
							},
							function(data,status){
								//console.log(data);
								if(data == 'novalidemail'){
									var n = noty({				
										text: 'Please enter a valid email address!',
										layout: 'bottomLeft',
										theme: 'defaultTheme',
										type: 'alert',
										animation: {
											open: {height: 'toggle'},
											close: {height: 'toggle'},
											easing: 'swing',
											speed: 500 // opening & closing animation speed
										},
										timeout: 2000				
									});
								} else if(data == 'mergefb'){					  
									  input_prompt("You have already had a Penana account with this email. Enter your Penana password to add Facebook Login to your account.", function(pw) {
										if (pw){
											pw = pw;
											$.post("/fblogin-callback.php",
											{ mergefb: 1,
											  fbloginemail: 1,
											  email: email,
											  action_token: csrf,
											  password: pw
											},
											function(data,status){
												//console.log(data);
												//return false;
												if(data == 'wrongpw'){
													var n = noty({				
														text: 'Wrong Password!',
														layout: 'bottomLeft',
														theme: 'defaultTheme',
														type: 'alert',
														animation: {
															open: {height: 'toggle'},
															close: {height: 'toggle'},
															easing: 'swing',
															speed: 500 // opening & closing animation speed
														},
														timeout: 2000				
													});
												
												} else {													
													window.location.reload(false); 
												}
											});
										}
									});
								  } else {
									window.location.reload(false); 
								}
							 });
						 }
					  }, 'Email');
				  } else {
					 // console.log(data);
					 window.location.reload(false); 
				  }
				}
			});			
			//testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      //document.getElementById('status').innerHTML = 'Please log ' +'into this app.';
    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      //document.getElementById('status').innerHTML = 'Please log ' + 'into Facebook.';
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }
  
  function fb_login(){
    FB.login(function(response) {
        statusChangeCallback(response);
    }, {
        scope: 'public_profile,email,user_location' //user_friends
    });
}

$(document).ready(function(){
  
  $('div').on('click', '.fblogin', function(e){
	  e.stopPropagation();
	  fb_login(); 
  });
  
});
</script>
<div id="bodywraper" class="maincenter">
<div class="faqwrap policywrap">
<h1>Terms of Service</h1>
<p>Welcome to Penana (the “Service”). The following Terms of Service apply when you view or use the Service via our website located at penana.com or its associated app/interface. Please review the following terms carefully. If you are under the age of majority in your country of residence, you must review this Agreement with your parent or guardian to make sure that you and your parent or guardian understand it. By accessing or using the Service, you signify your agreement to these Terms of Service. If you do not agree to these terms, you may not access or use the Service.
</p>
<b>PRIVACY POLICY</b>
<p>Penana Limited (the “Company”) respects the privacy of its Service users. Please refer to the Company’s <a href="/privacy.php">Privacy Policy</a> which explains how we collect, use, and disclose information that pertains to your privacy. When you access or use the Service, you signify your agreement to this Privacy Policy.
</p>
<b>PASSWORDS AND SECURITY</b>
<p>Your Account and any privileges granted to your account are for your sole use only and must not be used by any third party. You are responsible for safeguarding the password that you use to access the Service and for any activities or actions under your password, whether your password is with our Service or a third-party service. You shall notify us immediately of any unauthorized use of your password and/or account. The Company will not be responsible for any liabilities, losses, or damages arising out of the unauthorized use of your member name, password and/or account.
</p>
<b>USE RESTRICTIONS</b>
<p>Your permission to use the Site is conditioned upon the following Use Restrictions and Conduct Restrictions: You agree that you will not under any circumstances:
<ul class="browser-default">
<li>post any information that is abusive, threatening, obscene, defamatory, libelous, or racially, sexually, religiously, or otherwise objectionable and offensive;</li>
<li>use the service for any unlawful purpose or for the promotion of illegal activities;</li>
<li>attempt to, or harass, abuse or harm another person or group;</li>
<li>share your account credentials with someone else to allow them to access any part of the Paid Services or Content that such person did not order;</li>
<li>use another user’s account without permission;</li>
<li>impersonate others in a manner that does or is intended to mislead, confuse, or deceive others, or to misrepresent your identity or affiliation with any others;</li>
<li>create multiple accounts for disruptive or abusive purposes, or with overlapping use cases;</li>
<li>provide false or inaccurate information when registering an account;</li>
<li>distribute in any medium any part of the Website, including but not limited to User Content (defined below), without our prior written authorization;</li>
<li>interfere or attempt to interfere with the proper functioning of the Service;</li>
<li>make any automated use of the system, or take any action that we deem to impose or to potentially impose an unreasonable or disproportionately large load on our servers or network infrastructure;</li>
<li>bypass any robot exclusion headers or other measures we take to restrict access to the Service or use any software, technology, or device to scrape, spider, or crawl the Service or harvest or manipulate data; or</li>
<li>publish or link to malicious content intended to damage or disrupt another user’s browser or computer.</li>
</ul>
</p>
<b>POSTING AND CONDUCT RESTRICTIONS</b>
<p>When you create your own personalized account, you may be able to provide (“User Content”). You are solely responsible for the User Content that you post, upload, link to or otherwise make available via the Service. You agree that we are only acting as a passive conduit for your online distribution and publication of your User Content. The Company, however, reserves the right to remove any User Content from the Service at its discretion.
The following rules pertain to User Content. By transmitting and submitting any User Content while using the Service, you agree as follows:
<ul class="browser-default">
<li>You are solely responsible for your account and the activity that occurs while signed in to or while using your account;</li>
<li>You will not post information that is malicious, false or inaccurate;</li>
<li>You will not submit content that is copyrighted or subject to third party proprietary rights, including privacy, publicity, trade secret, etc., unless you are the owner of such rights or have the appropriate permission from their rightful owner to specifically submit such content; and</li>
<li>You hereby affirm we have the right to determine whether any of your User Content submissions are appropriate and comply with these Terms of Service, remove any and/or all of your submissions, and terminate your account with or without prior notice.</li>
</ul>
You understand and agree that any liability, loss or damage that occurs as a result of the use of any User Content that you make available or access through your use of the Service is solely your responsibility. The Company is not responsible for any public display or misuse of your User Content. The Company does not, and cannot, pre-screen or monitor all User Content. However, at our discretion, we, or technology we employ, may monitor and/or record your interactions with the Service.
</p>
<b>LINKS TO OTHER SITES AND/OR MATERIALS</b>
<p>As part of the Service, the Company may provide you with convenient links to third party website(s) (“Third Party Sites”) as well as content or items belonging to or originating from third parties (the “Third Party Applications, Software or Content”). These links are provided as a courtesy to Service users. The Company has no control over Third Party Sites and Third Party Applications, Software or Content or the promotions, materials, information, goods or services available on these Third Party Sites or Third Party Applications, Software or Content. Such Third Party Sites and Third Party Applications, Software or Content are not investigated, monitored or checked for accuracy, appropriateness, or completeness by the Company, and the Company is not responsible for any Third Party Sites accessed through the Site or any Third Party Applications, Software or Content posted on, available through or installed from the Site. Inclusion of, linking to or permitting the use or installation of any Third Party Site or any Third Party Applications, Software or Content does not imply approval or endorsement thereof by the Company. If you decide to leave the Site and access the Third Party Sites or to use or install any Third Party Applications, Software or Content, you do so at your own risk and you should be aware that our terms and policies no longer govern. You should review the applicable terms and policies, including privacy and data gathering practices, of any site to which you navigate from the Site or relating to any applications you use or install from the site.
</p>
<b>TERMINATION</b>
<p>Either party may terminate the Services at any time by notifying the other party. Penana Limited may also terminate or suspend any and all Services and access to the Site immediately, without prior notice or liability, if users breaches any of the terms or conditions of this Agreement. Upon termination of user's account, user’s right to use the Services, access the Site, and any Content will immediately cease. All provisions of this Agreement which by their nature should survive termination shall survive termination, including, without limitation, ownership provisions, and limitations of liability. Termination of Your access to and use of the Site and the Services shall not relieve users of any obligations arising or accruing prior to such termination or limit any liability which users otherwise may have to Penana Limited or the Site, including without limitation any indemnification obligations contained herein.
</p>
<b>INTELLECTUAL PROPERTY</b>
<p>You retain all of your ownership rights in your User Content Submissions, but we need licenses from you to operate the Services effectively. By displaying, posting or publishing any Content on or through the Site and Services, you hereby grant us a non-exclusive, sublicensable and royalty-free, worldwide, limited license to use, distribute, modify, delete from, add to, publicly perform, publicly display, reproduce and translate such Content in connection with the Penana Website and Penana's (and its successors' and affiliates') business, including without limitation distributing part or all of the Site in any media formats through any media channels.</p>
<b>PURCHASED AND RENTAL CONTENT, SUBSCRIPTION AND SPONSORING</b>
<p>Certain of the User Content on the Service may be subject to payments now or in the future. The payment could be on a one-off basis, or in the form of subscription model. Upon your payment of the applicable fees (including applicable taxes) for, the User Content provider grants you a non-exclusive right to view, use, and display such User Content, solely through Penana or its affiliated services or as otherwise permitted as part of the Service, and solely for your personal, non-commercial use, as long as the rights exist to provide you with that content, or during the period of time specified if there is any. The User Content is licensed, not sold, to you by the User Content Provider. Some content, such as interactive or highly formatted content, may not be available to you on your devices or applications. Purchased Content may become unavailable for viewing due to any number of reasons, including, but not limited to, content provider licensing and other restrictions. If your purchase includes the ability to download Purchased Content, we encourage you to download that content immediately after purchase. If an item of purchased content unexpectedly becomes unavailable within 30 days from the purchase date, you may request a refund.</p>
<p>For certain subscription plans, the User Content Provider may offer some "promises" on future benefits. We could not guarantee those promises could be honoured. We are not liable for loss associated with unfulfilled benefits and from losses caused by conflicting contractual agreements.</p>
<p>Certain of the User Content may be subject to voluntary “sponsors”, which is a way to express support and/or appreciation for the User Content providers. The payment of the fees typically would not grant you any additional rights, except otherwise specified. In some cases, you may be allowed to leave a sponsor's comment which would be relatively easily visible to the User Content provider and/or the readers of the story.</p>
<p>Unless specifically indicated otherwise, you may not sell, rent, lease, distribute, broadcast, sublicense, or otherwise assign any rights to the content or any portion of it to any third party. In addition, you may not attempt to bypass, modify, defeat, or otherwise circumvent any digital rights management system or other content protection or features used as part of the Service. We do not grant you any public performance, public display, commercial sale, resale, reproduction, or distribution rights for any User Content. You must comply with all applicable laws and with the terms of any licenses or agreements to which you are bound in your use of the Services.</p>
<p>
Penana makes no representations or warranties concerning:<br>
<ul class="browser-default">
<li>The availability of the User Content in a particular jurisdiction.</li>
<li>The availability of the User Content for any particular device, operating system, or browser.</li>
<li>The continued support for a particular feature of the Service.</li>
<li>The quality of any User Content or the suitability of any User Content for any audience. All opinions and statements expressed by or in User Content (or related materials) are those of the User and/or persons involved in the production of the User Content, not Penana.</li>
<li>The continued availability of any User Content.</li>
<li>Penana does not warrant that the operation of the software will be uninterrupted or error free.</li>
</ul>
</p>
<b>Terms of Sale</b>
<p>We may offer digital or non-digital products for sale within the Service. All orders are subject to availability and confirmation of the order price.</p>
<p>Where a contract is made with a third party Penana is not acting as either agent or principal and the contract is made between yourself and that third party and will be subject to the terms of sale which they supply you. When placing an order you undertake that all details you provide to us are true and accurate, that you are an authorized user of the credit or debit card or other payment methods used to place your order and that there are sufficient funds to cover the cost of the goods. The cost of foreign products and services may fluctuate. All prices advertised are subject to such changes.</p>
<p>Whilst we try and ensure that all details, descriptions and prices which appear on this Website are accurate, errors may occur. If we discover an error in the price of any goods which you have ordered we will inform you of this as soon as possible and give you the option of reconfirming your order at the correct price or cancelling it. If we are unable to contact you we will treat the order as cancelled. If you cancel and you have already paid for the goods, you will receive a full refund.
Delivery costs may be charged in addition; such additional charges are clearly displayed where applicable. </p>
<p>Dispatch times may vary according to availability and subject to any delays resulting from postal delays or force majeure for which we will not be responsible. </p>
<p>Penana may make changes to any products or services offered on the Site, or to the applicable prices for any such products or services, at any time, without notice. The materials on the Site with respect to products and services may be out of date, and Penana makes no commitment to update the materials on the Site with respect to such products and services.</p>
<b>DISCLAIMER</b>
<p>Opinions, advice, statements, offers, or other information or content made available through the Service, but not directly by the Company, are those of their respective authors, and should not necessarily be relied upon. Such authors are solely responsible for such content. The Company does not guarantee the accuracy, completeness, or usefulness of any information on the Service. The Company takes no responsibility and assumes no liability for any User Content that you or any other user or third party posts or sends over the Service. Under no circumstances will the Company be responsible for any loss or damage resulting from anyone’s reliance on information or other content posted on the Service, or transmitted to users.</p>
<p>Though the Company strives to enforce these Terms of Service, you may be exposed to User Content that is inaccurate or objectionable. The Company reserves the right, but has no obligation, to monitor the materials posted on the service or to limit or deny a user’s access to the Service or take other appropriate action if a user violates these Terms of Service or engages in any activity that violates the rights of any person or entity. If you become aware of misuse of our Service, please contact us at <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bad9d5d4cedbd9cefacadfd4dbd4db94d9d5d7">[email&#160;protected]</a>.
</p>
<p>The service, is provided “as is,” without warranty of any kind. The company makes no warranty or representation that access to or operation of the service will be uninterrupted or error free. You assume full responsibility and risk of loss resulting from your downloading and/or use of files, information, content or other material obtained from the service. Some jurisdictions limit or do not permit disclaimers of warranty, so this provision may not apply to you.
</p>
<p>You are solely responsible for your interactions with other users with whom you interact through the Service. The company reserves the right, but has no obligation, to become involved in any way with any disputes concerning the Service. If you have a dispute with one or more users, you release us (and our officers, directors, agents, subsidiaries, joint ventures and employees) from claims, demands and damages (actual and consequential) of every kind and nature, known and unknown, arising out of or in any way connected with such disputes.
</p>
<b>MODIFICATION OF TERMS OF SERVICE</b>
<p>We can amend these Terms of Service at any time and will update these Terms of Service in the event of any such amendments. It is your sole responsibility to check the Site from time to time to view any such changes in the Agreement. If you continue to use the Site, you signify your agreement to our revisions to these Terms of Service. However, we will notify you of material changes to the terms by posting a notice on our homepage and/or sending an email to the email address you provided to us upon registration. For this additional reason, you should keep your contact and profile information current.
</p>
<b>GENERAL</b>
<p>If any part of this Agreement is held invalid or unenforceable, that portion of the Agreement will be construed consistent with applicable law. The remaining portions will remain in full force and effect. Any failure on the part of the Company to enforce any provision of this Agreement will not be considered a waiver of our right to enforce such provision. Our rights under this Agreement will survive any termination of this Agreement.
You agree that any cause of action related to or arising out of your relationship with the Company must commence within ONE year after the cause of action accrues. Otherwise, such cause of action is permanently barred.</p>
<p>These Terms of Service and your use of the Site are governed by the laws of Hong Kong, without regard to conflict of law provisions.</p>
<p>YOU ACKNOWLEDGE THAT YOU HAVE READ THESE TERMS OF SERVICE, UNDERSTAND THE TERMS OF SERVICE, AND WILL BE BOUND BY THESE TERMS AND CONDITIONS. YOU FURTHER ACKNOWLEDGE THAT THESE TERMS OF SERVICE TOGETHER WITH THE <a href="/privacy.php">PRIVACY POLICY</a> REPRESENT THE COMPLETE AND EXCLUSIVE STATEMENT OF THE AGREEMENT BETWEEN US AND THAT IT SUPERSEDES ANY PROPOSAL OR PRIOR AGREEMENT ORAL OR WRITTEN, AND ANY OTHER COMMUNICATIONS BETWEEN US RELATING TO THE SUBJECT MATTER OF THIS AGREEMENT.
</p>
<p>Updated May 2022</p>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://assets.penana.com/css/loginpage.1724780054.css" />
<div class="popupwrap displaynone" id="login-popup">
<div class="mask pseudoclose"></div>
<div class="popupbox popup">
<div class="loginregwrap">
<div class="displayflex">
<div class="floatright1 floatright2 positionrelative">
<div class="popuploginregbox">
<h5><div class="regwrap">REGISTER</div><div class="logbuttonwrap"><img src="https://static.penana.com/img/log/4.png"></div></h5>
<form class="registerform authform" action="/register.php" method="post">
<input type="text" name="user_name" class="writebox" placeholder="Pen Name" value required />
<input type="text" name="email" class="writebox" placeholder="Email" value required />
<input type="password" name="password" class="writebox" placeholder="Password" value required />
<input type="checkbox" name="terms" class="floatleft" style="position: absolute;top: -2000px;" />
<input type="hidden" name="dum" value />
<input type="hidden" name="time" value="1726004813" />
<label for="tou" class="toulabel">
<input type="checkbox" id="tou" name="tou" class="floatleft" required />
<span>I have read, understand, and agree to the Penana <a href="/terms.php" target="_blank">Terms of Service</a>.</span>
</label>
<input type="hidden" name="redirurl" value="/terms" />
<div class="authbuttonwrap">
<div class>
<input type="submit" class="authbutton" value="JOIN!" />
</div>
</div>
</form>
</div>
</div>
<div class="floatright1 positionrelative">
<div class="popuploginregbox">
<h5><div class="regwrap">LOGIN</div><div class="logbuttonwrap"><img src="https://static.penana.com/img/log/5.png"></div></h5>
<form class="loginform authform" action="/login.php" method="post">
<input type="email" name="email" class="writebox" placeholder="Email" value required />
<input type="password" name="password" class="writebox" placeholder="Password" value required />
<input type="hidden" name="redirurl" value="/terms" />
<label for="checkbox" class="toulabel">
<input type="checkbox" class="checkbox" id="checkbox" name="rmbme" value="1" />
<span>Remember Me</span>
</label>
<br><a href="/forgot_password.php" class="fgtpw">Forget Password?</a>
<div class="mobilehide" style="height:55px;width:10px;"></div>
<div class="authbuttonwrap">
<div class>
<input type="submit" class="authbutton" value="GO!" />
</div>
</div>
</form>
</div>
</div>
</div>
<div class="logregfb">
<div class="logregor"><span>OR</span></div>
<div class="fblogin fblogin_big">
<img src="https://static2.penana.com/img/log/facebook_blue.png" width="30px"><span class="fblogintxt">Login with Facebook</span>
</div>
</div>
</div>
</div>
</div><div class="popupwrap displaynone scroll subscribe_user"> <div class="mask pseudoclose"></div>
<div class="popupbox logregpopup popup scroll">
<div class="progressbar progress displaynone nomargin absolutebottom"><div class="indeterminate"></div></div>
<div class="padding10px underbar invitebox thbox"> <a class="close ignorelink closebtn" alt="Close">×</a>
<div class="popup_subtitle">Subscribe</div>
<form class="subscription_form alignleft ">
<div class="center"><div class="plan_pic"></div></div>
<div class="plan_name"></div>
<div class="displaynone maglink center"><a href target="_blank">Go to the magazine</a></div>
<div class="plan_details"></div>
<div class="unlocked_stories"></div>
<div class="startpay paycard">
<div class="plan_price_wrap displayflex gap10 margintopbottom">
<div class="plan_option active">
<span class="plan_price_num"></span>
<span class="plan_slash">/</span>
<span class="plan_interval_span"></span>
<span class="free_trial_text free_trial_show"></span>
</div>
</div>
<div class="paddingbottom addtipwrap">
<a class="cursorpointer addtip">+ Add tip</a>
<div class="addtip_div displaynone glowdim margintopbottom">
<div>
<span class="currency_symbol"></span>
<input type="number" name="tip" class="tipamount singlelinebox inputnosubmit" style="width:50px" min="0" step="0.1" />
<div class="inlineblock"></div>
</div>
<div class="greycolor font12px">The tip will be charged every payment period</div>
</div>
</div>
<div class="paddingbottom addcodewrap displaynone">
<a class="cursorpointer addcode">+ Add promotion code</a>
<div class="addcode_div displaynone glowdim margintopbottom">
<span class="codearea"><input type="text" name="promocode" class="codeinput" placeholder="Promotion code" /><span class="btn btn-small applysubcode">Apply</span></span>
<span class="chip promochip hide"><span class="promotext"></span><i class="close material-icons cancelcode">close</i></span>
<span class="coupon_desc"></span>
</div>
</div>
<div class="displaynone shipping_address">
<div class="shipping_info">
<hr class="penanahr">
<div class="popup_subtitle">Recipient Name</div>
<input type="text" name="recipient_name" class="singlelinebox inputnosubmit adreq" value /><br>
<div class="popup_subtitle">Shipping address</div>
<input type="text" name="address1" class="singlelinebox inputnosubmit adreq" /><br>
<input type="text" name="address2" class="singlelinebox inputnosubmit" /><br>
<input type="text" name="address3" class="singlelinebox inputnosubmit" /><br>
<div class="popup_subtitle">Phone Number</div>
<input type="tel" name="phone" class="singlelinebox inputnosubmit adreq" id="phone" value /><p></p>
</div>
<label class="displaynone">
<input type="checkbox" name="no_physical" class="no_physical" value="1" autocomplete="off">
<span>I prefer <b>not to receive</b> the physical benefits.</span>
</label><br>
</div>
<a href="#" class="join_plan aligncenter btn width100 margintop5px waves-effect displayblock ignorelink elevated" onclick="login_popup();return false;">JOIN</a>
<div class="center loader displaynone"><img src="https://assets.penana.com/img/ajax-loader2.gif" /></div>
<div class="paywithsavedcard displaynone">
<div class="modal-content paddingtop10">
<div class>Pay with</div>
<div style="margin:5px 0 10px 0">
<img src width="50" class="cardimage" style="vertical-align:middle" />
xxxx xxxx xxxx <span class="last4"></span>
</div>
<a href="#" class="update_payment_method bluelink ignorelink" style="font-size:12px;">Update payment method</a>
</div>
<div class="padding15px alignright">
<a href="#!" class="no_select waves-effect waves-green btn ignorelink confirmpayment">Confirm</a>
<a href="#!" class="cancelpay modal-close no_select waves-effect waves-red grey-text btn-flat ignorelink">Cancel</a>
</div>
</div>
<div class="greycolor exptext margintop15px margintop10 font12px">
<span class="displaynone one_time_purchase expdesc">This is a one-time purchase.</span>
<div class="recurring_subscription">
<span class="displaynone free_trial_show expdesc">If you don't cancel before the trial ends, you will automatically be charged the subscription fee every <span class="plan_interval_span"></span> until you cancel. </span>
<span class="no_trial_show expdesc">Renews automatically every <span class="plan_interval_span"></span>, unless you decide to cancel. You can cancel your subscription at any time.</span>
</div>
</div>
<div class="errormsg"></div>
</div>
<div class="displaynone paynoncard">
<div class="font12px">
<div class="amtlimit">You can pay with non-card methods if you subscribe for <b>12 months</b>.</div>
<div class="displaynone noamtlimit">Please leave your contact phone number here.</b>.</div>
<div>We will reach you soon by Whatsapp at the tel number you provide.</div>
</div>
<input type="tel" name="contactnum" placeholder="Tel No." class value>
<a href="#" class="plan_phone_number aligncenter btn width100 margintop5px waves-effect displayblock ignorelink">SUBMIT</a>
<div class="displaynone errormsg margintop5px phoneremind">Please enter phone number.</div>
<p class="font12px"><a href="#" class="yescreditcard ignorelink bluelink">Credit card payment</a></p>
</div>
<div class="displaynone subscribed_word">
<b>You have subscribed to this plan already!</b>
<div><a href="/my_subscriptions" class="toinner bluelink">Manage subscriptions</a></div>
</div>
<p></p>
<input type="hidden" name="action" class value="noncardpayment" />
<input type="hidden" name="purchase" class value="joinplan" />
<input type="hidden" name="success_redirect" class="success_redirect" value />
<input type="hidden" name="cancelled_url" class="cancelled_url" value />
<input type="hidden" name="plan_currency" class="plan_currency" value />
<input type="hidden" name="product_id" class="product_id" value />
<input type="hidden" name="price_id" class="price_id" value />
<input type="hidden" name="price" class="price" value />
<input type="hidden" name="interval" class="interval" value />
<input type="hidden" name="description" class="description" value />
<input type="submit" class="displaynone" />
<input type="hidden" name="trial_days" class="trial_days" value />
<input type="hidden" name="physical_benefits" class="physical_benefits" value />
<input type="hidden" name="welcome_note" class="welcome_note" value />
<input type="hidden" name="welcome_message" class="welcome_message" value />
<input type="hidden" name="foreign_currencies" class="foreign_currencies" value />
<input type="hidden" name="plan_id" class="plan_id" value />
</form>
</div>
</div>
</div>
<div class="displaynone shownotinotice notification-popup">
<span class="notification-title">Never miss what's happening on Penana!</span>
<div class="displayflex aligncenter margin10px notification-buttons">
<a href class="shownoti ignorelink flexone positive-button">Turn on notifications</a>
<div class="flexone"><a href class="notshownoti ignorelink negative-button">Later</a></div>
</div>
<span class="notshownoti closenoti">
<img src="https://static2.penana.com/img/close_pop.png" width="20px" class alt="Close" style="vertical-align: bottom;cursor: pointer;">
</span>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>

$("html,div").on("click", ".closenoti", function(e){
	e.stopPropagation();
	$(this).closest(".notification-popup").hide();
	setCookie("noheadnoti","1",3);
});

// tracking links

function asynScript(){	  
	
	// scroll bar
	$(".scrollbar").perfectScrollbar();
	
	// auto link	
	var boxes = document.querySelectorAll('.autolink');
	i = boxes.length;
	while(i--) {
		boxes[i].innerHTML = Autolinker.link(boxes[i].innerHTML );
	} 
  
  $('.ajax-popup-link').magnificPopup({
	  type: 'ajax'
	});
	
	$('.clickenlarge').magnificPopup({type:'image', fixedContentPos: false});
	
	$('.gallery-item').magnificPopup({
	  type: 'image',
	  gallery:{
		enabled:true
	  },
	  fixedContentPos: false,
	  callbacks: {
      open: function() {
		  $(".mfp-img").attr('draggable', 'false');
		}
	  }
	});
}
</script>
<script src="https://assets.penana.com/js/libfoot.1625412024.js" type="text/javascript" async onload="asynScript()"></script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
  import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-messaging.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDAlggxdA5rUgnWTzBBGkR3JAI_tpwLjUM",
    authDomain: "penanafirebase-dfff5.firebaseapp.com",
    databaseURL: "https://penanafirebase-dfff5.firebaseio.com",
    projectId: "penanafirebase-dfff5",
    storageBucket: "penanafirebase-dfff5.appspot.com",
    messagingSenderId: "858908977225",
    appId: "1:858908977225:web:26dee5fecc5f2451f17798",
    measurementId: "G-GNB03S1EEY"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const messaging = getMessaging(app);
  
	//Request permission to receive notifications
	function requestPermission(){
		Notification.requestPermission().then((permission) => {
		if (permission === 'granted') {
			console.log('Notification permission granted.');
			resetUI();
		} else {
			console.log('Unable to get permission to notify.');
		}
		}).catch((err) => {
		console.log('Unable to get permission to notify.', err);
		});
	}
	
	onMessage(messaging, (payload) => {
		console.log('Message received. ', payload);
		if(window.location.pathname == "/message" && payload.data.url == window.location.pathname+window.location.search){
			var from_user_id = $('.refreshmsguser').attr('data-id');
			
			if($('.mmessage').find('.refreshbar').length){
				// have refresh bar already
			} else {				
				$('.mmessage').prepend("<div class='refresh refreshbar refreshmsguser' data-id='"+from_user_id+"'>You have new messages. Click to refresh.</div>");
			}			
			
			return false;
		}
		
		// show alert popup
		$('.alert_link').attr('href', payload.data.click_action);
		$('.alert_title').html(krEncodeEntities(payload.data.title));
		$('.alert_body').html(krEncodeEntities(payload.data.body));
		$('.alert_popover').show();
		
		// detect if hovering
		$('.alert_link').hover(function(){
			$(this).addClass('hovering'); //store in that element that the mouse is over it
		},
		function(){
			$(this).removeClass('hovering'); //store in that element that the mouse is no longer over it
		});
				
		// hide popup
		var hideAlert = setInterval(function(){ 	
			
			if($('.alert_link').hasClass('hovering')){
				//hovering				
			} else{
				$('.alert_link:not(.hovering)').closest('.alert_popover').fadeOut();
				 clearInterval(hideAlert);
			}
			
		}, 10000);	

		
		updateMyCount();
		
	});	

	// Listen for messages from the service worker
	navigator.serviceWorker.addEventListener('message', (event) => {
		if (event.data && event.data.type === 'NOTIFICATION_CLICK') {
			const url = event.data.url;
			if (url) {
			// Use the History API to navigate within the PWA
			history.pushState(null, '', url);
			// Dispatch a custom event to notify your app of the navigation
			window.dispatchEvent(new CustomEvent('navigated', { detail: { url } }));
			}
		}
	});
		
	async function resetUI() {
		try {
			// Get current notification permission status
			const permission = Notification.permission;

			if (permission === 'granted') {
				// If permission is granted, retrieve the current token
				const currentToken = await getToken(messaging, { vapidKey: 'BDlHeQtoCFvACPQE30SIhWrAC9_O7UMeSD1QRdqtIAP2BzcVj1oQ1k79cBGw79LQT5dSOLiAatNYhXW_98yb78g' });

				if (currentToken) {
					// Send the token to your server
					sendTokenToServer(currentToken);
				} else {
					console.log('No registration token available. Cannot retrieve one.');
					checkForIncognitoMode();
					setTokenSentToServer(false);
				}
			} else if(permission == 'default'){
				console.log('Notification permission default.');
				// Handle the case where permission is not yet decided
				checkForIncognitoMode();
				setTokenSentToServer(false);
			} else {
				console.log('Notification permission denied.');
				// Handle the case where permission is denied
			}
		} catch (err) {
			console.log('An error occurred while retrieving token: ', err);
			setTokenSentToServer(false);
		}
	}

	// Expose the function to the global scope
	window.resetUI = resetUI;

	function checkForIncognitoMode() {
		const fs = window.RequestFileSystem || window.webkitRequestFileSystem;
		if (fs) {
			fs(window.TEMPORARY, 100, function(fs) {
				$('.shownotinotice').show();
			}, function(err) {
				console.log('User might be in incognito mode.');
				$('.shownotinotice').show();
			});
		}
	}

	resetUI();

	  // [END get_token]	
	// Feature test for localStorage
	var hasStorage = (function() {
	  try {
		localStorage.setItem("test", "test");
		localStorage.removeItem("test");
		return true;
	  } catch (exception) {
		console.log(exception);
		return false;
	  }
	}());
	
	// Send the Instance ID token your application server, so that it can:
	// - send messages back to this app
	// - subscribe/unsubscribe the token from topics
	function sendTokenToServer(currentToken) {
		//if (!isTokenSentToServer()) {
		if (currentToken != getCurrentToken()) {
		  // console.log('Sending token to server...');
		  //console.log(currentToken);
		  // Send the current token to your server.
		  var csrf = $('meta[name="csrf-token"]').attr('content');
		  $.ajax({
			type:'POST',
			url:'/process.php',
			data:{action: "storetoken", token : currentToken, action_token: csrf, user_id: 0},
			success:function(data){
				//console.log(data);
			}
		  }); 
		  setNotiToken(currentToken);
		  //setTokenSentToServer(true);
		} else {
		  //console.log('Token already sent to server so won\'t send it again ' +'unless it changes');
		}
	  }
	  
	  function isTokenSentToServer() {
		return window.localStorage.getItem('sentToServer') == 1;
	  }
	  
	  function getCurrentToken() {
		if(hasStorage){  
			return window.localStorage.getItem('notiToken');
		}
	  }			  
	  
	  function setTokenSentToServer(sent) {
		window.localStorage.setItem('sentToServer', sent ? 1 : 0);
	  }
	  
	  function setNotiToken(token){
		if(hasStorage){
			window.localStorage.setItem('notiToken', token);
		}
	  }
	  
	  // not show noti notice
		$(document).on('mousedown click', '.notshownoti', function(e) {
			e.preventDefault();
			$(this).closest('.shownotinotice').hide();
			setCookie("notshownotinotice", 1, 200);
			sendevent("allownoti", "rejected");		
			return false;
		});
		
		// not noti notice
		$(document).on('mousedown click', '.shownoti', function(e) {
			e.preventDefault();
			$(this).closest('.shownotinotice').hide();
			requestPermission(); 
			sendevent("allownoti", "accepted");		
			return false;
		});
</script>
<script>	  
	  $(document).on('click', '.close_alert', function(e){
		  e.preventDefault();
		  $(this).closest('.alert_popover').hide();
	  });
	  	  


	 $("html,div").on("click", ".addbookmarkButton", function(e){
		e.preventDefault();   
		var story_id = $(this).closest('.newXbox').attr('data-id');
		
		$(this).addClass('active');
		$(this).html("Bookmark Added!");
		
		$.post("/process.php",
		{
		  story_id: story_id,	  
		  action: 'bookmark',
		  r: 'json',
		  action_token:csrf
		},
		function(data,status){		
			
			//console.log(data);
			var obj = JSON.parse(data);
		
			if (obj.status == 'Not Login'){
				login_popup();
			} else if (obj.status == 'Error'){
				$(this).removeClass('active');
			} else {
			   // do nothing
			}
			sendevent("story_actions", 'bookmark', 'desktop');
		});
	  });
	  
	  	  
	  document.addEventListener('DOMContentLoaded', function() {
		var elems = document.querySelectorAll('select');
		var instances = M.FormSelect.init(elems);
	  });
	  
	  //$('.collapsible').collapsible();


$(".snapcontent:last .scroll_menu_wrapper").each(function() {
	var menuWrapperSize = $(this).outerWidth();
	
	// get total width of all menu items
	if ( $(this).find( ".scroll_menu" ).length ) {
		var menuSize =  $(this).find('.scroll_menu')[0].scrollWidth
		//return itemsLength * itemSize;
	} else {
		var menuSize = 0;
	}				
	
	//console.log(menuSize);	
	//console.log(menuWrapperSize);		
	
	// get how much of menu is invisible
	var menuInvisibleSize = menuSize - menuWrapperSize;
	
	if(menuSize == 0 || (menuWrapperSize>0 && menuInvisibleSize<=1)){
		$(this).find('.left-paddle').addClass('displaynone');
		$(this).find('.right-paddle').addClass('displaynone');
	}
	
});	

var scrollDuration = 300;
var paddleMargin = 5;

// finally, what happens when we are actually scrolling the menu
$('html, div').on('custom-scroll', '.scroll_menu', function(e) {
				
	e.stopPropagation();			
	
	var menuSize = $(this)[0].scrollWidth;
	var menuWrapperSize = $(this).closest('.scroll_menu_wrapper').outerWidth();
	// get how much of menu is invisible
	menuInvisibleSize = menuSize - menuWrapperSize;
	
	var leftPaddle = $(this).closest('.scroll_menu_wrapper').find('.left-paddle');
	var rightPaddle = $(this).closest('.scroll_menu_wrapper').find('.right-paddle');
	
	if(menuWrapperSize>0 && menuInvisibleSize<=1){
		$(leftPaddle).addClass('displaynone');
		$(rightPaddle).addClass('displaynone');
		//console.log('addnone');
		return false;
	}

	// get how much have we scrolled so far
	var menuPosition = $(this).scrollLeft();				
	
	//console.log(menuPosition);			
	//console.log(menuInvisibleSize);

	var menuEndOffset = menuInvisibleSize - paddleMargin;
	
	// show & hide the paddles 
	// depending on scroll position

	//console.log(menuPosition);
	//console.log(menuEndOffset);
	//console.log($(leftPaddle).html());
	//console.log(menuEndOffset);
	//console.log(menuPosition);

	if (menuPosition <= paddleMargin) {
		$(leftPaddle).addClass('displaynone');
		$(rightPaddle).removeClass('displaynone');
	} else if (menuPosition < menuEndOffset) {
		// show both paddles in the middle
		$(leftPaddle).removeClass('displaynone');
		$(rightPaddle).removeClass('displaynone');
	} else if (menuPosition >= menuEndOffset) {					
		$(leftPaddle).removeClass('displaynone');
		$(rightPaddle).addClass('displaynone');
	}

});

// initialize
$(".scroll_menu").trigger("custom-scroll");

$(".scroll_menu").on("scroll", function(e){
	$(this).trigger("custom-scroll");
});

// scroll to left
$('html,div').on('click', '.right-paddle', function(e) {
	e.stopPropagation();
	var scroll_menu = $(this).closest('.scroll_menu_wrapper').find('.scroll_menu');
	var menuPosition = $(scroll_menu).scrollLeft();
	$(scroll_menu).animate( { scrollLeft: menuPosition +500}, {duration:scrollDuration, complete: function(){
								$(scroll_menu).trigger("custom-scroll");
							}
						});
});

// scroll to right
$('html,div').on('click', '.left-paddle', function(e) {
	e.stopPropagation();
	var scroll_menu = $(this).closest('.scroll_menu_wrapper').find('.scroll_menu');
	var menuPosition = $(scroll_menu).scrollLeft();				
	$(scroll_menu).animate( { scrollLeft:  menuPosition -500 }, {duration:scrollDuration, complete: function(){
								$(scroll_menu).trigger("custom-scroll");
							}
						});
});

// page navigation
$('html,div').on('change', '.pagechange', function() {
	window.location.href = this.value;
});		

// subscription

var unlocked_stories_title = 'Join to unlock the following publications:';
var subscribed_already = 'You have subscribed to this plan already!';

function propagatePlan(sourceDiv, subscription_form){
			
	var plan_id = $(sourceDiv).attr("plan-id");
	var price_id = $(sourceDiv).attr("price-id");
	var product_id = $(sourceDiv).attr("product-id");
	var pic = $(sourceDiv).attr("pic");
	var description = $(sourceDiv).attr("description");
	var subscribed = $(sourceDiv).attr("subscribed");
	var trial_days = $(sourceDiv).attr("trial-days");
	var trial_days_text = $(sourceDiv).attr("trial-days-text");
	var join_plan_text = $(sourceDiv).attr("join-plan-text");
	var magazine_id = $(sourceDiv).attr("magazine-id");
	var allows_promocode = $(sourceDiv).attr("allows-promocode");
	var plan_name = $(sourceDiv).find(".plan_name").text();
	var plan_currency = $(sourceDiv).attr("data-currency");
	var plan_price = $(sourceDiv).attr("data-price");
	var interval = $(sourceDiv).attr("data-interval");
	var currency_symbol = $(sourceDiv).find(".currency_symbol").text();
	var plan_price_num = $(sourceDiv).find(".plan_price_num").text();
	var plan_interval = $(sourceDiv).find(".plan_interval").text();
	var unlocked_stories = $(sourceDiv).find(".unlocked_stories").html();
	var physical_benefits = $(sourceDiv).find(".physical_benefits").html();
	var foreign_currencies = $(sourceDiv).find(".foreign_currencies").html();
	var interval_price = $(sourceDiv).find(".interval_price");
	var welcome_note = $(sourceDiv).find(".welcomenote").attr("data-id");
	var welcome_message = $(sourceDiv).find(".welcomenote").html();
	
	var subform = $(sourceDiv).closest(".sub_wrap").find(".subform.sub"+plan_id);
	var success_redirect =  $(subform).find("input[name=success_redirect]").val();
	var cancelled_url =  $(subform).find("input[name=cancelled_url]").val();
	
	if(subscribed == 1){
		$(subscription_form).addClass("subscribed");
	} else {
		$(subscription_form).removeClass("subscribed");
	}
	
	if(allows_promocode == 1){
		$(subscription_form).find(".addcodewrap").show();
	} else {
		$(subscription_form).find(".addcodewrap").hide();
	}
	
	if(magazine_id > 0){
		$(subscription_form).find(".maglink").show();
		$(subscription_form).find(".maglink a").attr("href", "/magazine/"+magazine_id);
		$(subscription_form).find(".noamtlimit").show();
		$(subscription_form).find(".amtlimit").hide();
	} else {
		$(subscription_form).find(".maglink").hide();
		$(subscription_form).find(".amtlimit").show();
		$(subscription_form).find(".noamtlimit").hide();
	}
	
	if(pic !== ''){			
		$(subscription_form).find(".plan_pic").html("<img src='"+pic+"' width='100' />");		
	}
	
	$.each($(subscription_form).find(".url_append_id"), function (i, currProgram) {
		$(this).attr("href", $(this).attr("data-href")+plan_id);
	});
	
	//$(subscription_form).attr("data-id", "plan_"+plan_id);		
	$(subscription_form).find(".plan_name").html(plan_name);		
	$(subscription_form).find(".plan_details").html(description);
	$(subscription_form).find(".plan_price_num").html(plan_price_num);
	$(subscription_form).find(".plan_interval_span").html(plan_interval);
		
	$(subscription_form).find(".foreign_currencies").val(foreign_currencies);
	$(subscription_form).find(".currency_symbol").html(currency_symbol);
	$(subscription_form).find(".plan_currency").val(plan_currency);
	$(subscription_form).find(".plan_id").val(plan_id);
	$(subscription_form).find(".price_id").val(price_id);
	$(subscription_form).find(".product_id").val(product_id);
	$(subscription_form).find(".interval").val(interval);
	$(subscription_form).find(".description").val(plan_name);
	$(subscription_form).find(".trial_days").val(trial_days);
	$(subscription_form).find(".free_trial_text").html(trial_days_text);
	$(subscription_form).find(".join_plan").html(join_plan_text);
	$(subscription_form).find(".success_redirect").val(success_redirect);
	$(subscription_form).find(".cancelled_url").val(cancelled_url);
	$(subscription_form).find(".welcome_note").val(welcome_note);
	$(subscription_form).find(".welcome_message").val(welcome_message);
	
	$(subscription_form).find(".expdesc").hide();
	if(trial_days !== '' && trial_days > 0){
		$(subscription_form).find(".free_trial_show").show();
	} else {
		if(interval == 'o'){ // one-off payment
			//$(subscription_form).find(".plan_slash").hide();
			$(subscription_form).find(".one_time_purchase").show();
		} else {
			//$(subscription_form).find(".plan_slash").show();
			$(subscription_form).find(".no_trial_show").show();
		}
	}
	
	// reset and show other plans
	$(subscription_form).find(".otherplans").remove();
	
	var ori_plan_option = $(subscription_form).find(".plan_option");
	$(ori_plan_option).attr("price-id", price_id);		
	$(ori_plan_option).attr("price", plan_price);		
	$(ori_plan_option).attr("interval", interval);	
	$(ori_plan_option).attr("trial-days", trial_days);		
	$(ori_plan_option).attr("trial-days-text", trial_days_text);			
	$(ori_plan_option).attr("join-plan-text", join_plan_text);			
		
	if(interval_price.length > 0){
		$(ori_plan_option).addClass("plan_select hovergrey");
		$(interval_price).each(function() {
			var sub_price_id = $(this).attr("price-id");
			var sub_price = $(this).attr("price-show");
			var sub_interval_val = $(this).attr("interval-val");
			var sub_interval = $(this).attr("interval-show");
			var sub_price_num = $(this).attr("data-price");
			var sub_trial_days = $(this).attr("trial-days");
			var sub_trial_days_text = $(this).attr("trial-days-text");
			var sub_join_plan_text = $(this).attr("join-plan-text");
			
			var trial_span = "";
			if(sub_trial_days_text != ""){
				trial_span = "<span class='free_trial_text free_trial_show'>"+sub_trial_days_text+"</span>";
			}
			
			var discount_span = "";
			if(sub_interval_val=='y' && interval == 'm'){
				var discount = 100-Math.round(sub_price_num*100/(plan_price*12));
				if(discount > 1){
					discount_span = "<span class='plan_discount'>"+discount+"% off</span>";
				}
			}
			
			var option_html = '<div class="plan_option otherplans plan_select hovergrey" price-id="'+sub_price_id+'" price="'+sub_price_num+'" interval="'+sub_interval_val+'" join-plan-text="'+sub_join_plan_text+'" trial-days-text="'+sub_trial_days_text+'" trial-days="'+sub_trial_days+'"><span class="plan_price_num">'+sub_price+'</span>/<span class="plan_interval_span">'+sub_interval+'</span>'+trial_span+discount_span+'</div>';			
			$(subscription_form).find(".plan_price_wrap").append(option_html);
		});
	} else {
		$(subscription_form).find(".plan_option").removeClass("plan_select hovergrey");
	}	
	
	$(subscription_form).find(".unlocked_stories").html("");
	if(typeof unlocked_stories != 'undefined' && unlocked_stories != ''){
		$(subscription_form).find(".unlocked_stories").append("<div><b>"+unlocked_stories_title+"</b></div>");
		$(subscription_form).find(".unlocked_stories").append(unlocked_stories);
		$(subscription_form).find(".unlocked_stories").append("<p></p>");
	}
	
	if(typeof physical_benefits != 'undefined' && physical_benefits != ''){
		$(subscription_form).find(".physical_benefits").val(physical_benefits);
		$(subscription_form).find(".shipping_address").show();
		$(subscription_form).find(".shipping_info").find("input").attr("disabled", false);
		$(subscription_form).find(".adreq").attr('required', true);
		autoFillContact();
	} else {
		$(subscription_form).find(".physical_benefits").val("");
		$(subscription_form).find(".shipping_address").hide();
		$(subscription_form).find(".shipping_info").find("input").attr("disabled", true);
		$(subscription_form).find(".adreq").attr('required', false);
	}
	
	// GA log
	sendevent("pay", 'desktop_join_plan_step1', plan_name+" ("+plan_id+")");
}

function autoFillContact() {
	
	// autofill user contact information
	var csrf = $('meta[name="csrf-token"]').attr('content');
	$.get("/ajax_my_contacts.php",
	{ 
	  action_token: csrf
	},
	function(data,status){						
		if(data != ""){
			var obj = data ? JSON.parse(data) : {};
			if(obj != ""){
				// html form
				$("input[name='address1']").val(obj[0].address1);
				$("input[name='address2']").val(obj[0].address2);
				$("input[name='address3']").val(obj[0].address3);							
				$("input[name='postal_code']").val(obj[0].postal_code);
				$("input[name='phone']").val(obj[0].phone);
											
				// values with default values
				if(obj[0].recipient_name){
					$("input[name='recipient_name']").val(obj[0].recipient_name);								
				}
				if(obj[0].country_of_residence){
					$("input[name='country_of_residence']").val(obj[0].country_of_residence);								
				}
			}
		}
	});
}

$('html,div').on('change', '.no_physical', function(e) {
	e.stopPropagation();
	var subscription_form = $(this).closest(".subscription_form");
	if($(this).is(':checked')){
		$(subscription_form).find(".shipping_info").find("input").attr("disabled", true);
		$(subscription_form).find(".adreq").attr('required', false);
	} else {
		$(subscription_form).find(".shipping_info").find("input").attr("disabled", false);
		$(subscription_form).find(".adreq").attr('required', true);
	}
});

function getDefaultPayment(currency){	
	
	// current disable default payment
	return new Promise((success) => { success([]); }) 

	/*
	return new Promise(function(resolve, reject) {
    $.ajax({
      url: "/retrieve-default-payment",
      type: 'post',
      data:  { currency: currency},
      success: resolve,
      error: reject
    });
  });*/
}
	
$("html, div").on("change", ".tipamount", function(e){
	e.stopPropagation();
	e.preventDefault();
	
	var tip = $(this).val();
	var thisform = $(this).closest('form');
	$(thisform).find(".price_id").val("");
	
	var ori_price = $(thisform).find(".plan_option.active").attr("price");
	var totalprice = parseInt(tip*100)+parseInt(ori_price);	
	$(thisform).find(".price").val(totalprice);
	
});

$('div,html').on('click', '.cancelcode', function(e) {
	e.stopPropagation();
	e.preventDefault();
	
	var btn = $(this);
	var form = $(this).closest('form');
	
	$(".coupon_desc").html("");
	$(".codearea").show();
	$(".promotext").text("");
	$(".promochip").hide();
	
});

$('div,html').on('click', '.applysubcode', function(e) {
		e.stopPropagation();
		e.preventDefault();
		
		var btn = $(this);
		var code = $(".codeinput").val();
		var plan_id = $(btn).closest("form").find(".plan_id").val();
		
		$.ajax({
		  type: 'POST',
		  url: "/applycode",
		  data: {promocode: code, action: "subplan", plan_id: plan_id},
		  success: function(data){
			  
			  var obj = JSON.parse(data);
			  
			  if(obj.status == 'empty'){
				  var invalidcode =  "Invalid promotion code";			  
				  M.toast({html: invalidcode}); 
			  } else if(obj.status == 'success'){
				  if(obj.id){
					  var coupon_name = obj.coupon_name;
					  
					  var form = $(btn).closest('form');
					  
						$(form).find(".coupon_desc").html(coupon_name);			
						$(form).find(".codearea").hide();
						$(form).find(".promotext").text(code);
						$(form).find(".promochip").removeClass("hide").show();
				  }
			  }
		  }
		});	
	});

$("html, div").on("click", ".addcode", function(e){
	e.stopPropagation();
	e.preventDefault();
	$(this).closest('form').find(".addcode_div").show();
	$(this).closest('form').find(".codearea").show();
});

$("html, div").on("click", ".addtip", function(e){
	e.stopPropagation();
	e.preventDefault();
	$(this).closest('form').find(".addtip_div").show();
});
	
$("html, div").on("click", ".plan_select", function(e){
	e.stopPropagation();		
	$(this).closest(".plan_price_wrap").find(".plan_select").removeClass("active");
	$(this).addClass("active");
	
	var thisform = $(this).closest('form');
	
	var interval = $(this).attr("interval");
	$(thisform).find(".interval").val(interval);

	var trial_days = $(this).attr("trial-days");
	$(thisform).find(".trial_days").val(trial_days);

	if(trial_days != "" && trial_days > 0){
		$(thisform).find(".exptext .free_trial_show").show(); 
		$(thisform).find(".exptext .no_trial_show").hide(); 
	} else {
		$(thisform).find(".exptext .free_trial_show").hide(); 
		$(thisform).find(".exptext .no_trial_show").show(); 
	}
	
	var tip = $(thisform).find(".tipamount").val();
	if(tip > 0){
		var ori_price = $(thisform).find(".plan_option.active").attr("price");
		var totalprice = parseInt(tip*100)+parseInt(ori_price);	
		$(thisform).find(".price").val(totalprice);
	} else {
		var price_id = $(this).attr("price-id");
		$(thisform).find(".price_id").val(price_id);
	}

	if(interval == 'o'){
		$(thisform).find(".one_time_purchase").show(); // one-off payment
		$(thisform).find(".recurring_subscription").hide();
	} else {
		$(thisform).find(".one_time_purchase").hide(); // one-off payment
		$(thisform).find(".recurring_subscription").show();
	}

	var join_plan_text = $(this).attr("join-plan-text");
	$(thisform).find(".join_plan").text(join_plan_text);
});

$("html, div").on("click", ".start_sub", function(e){
	e.stopPropagation();
					
	var thisbtn = $(this);
	// popup
	var beginsubscribe = $(".subscribe_user");
	var subscription_form = $(beginsubscribe).find(".subscription_form");
					
	propagatePlan(thisbtn, subscription_form);				
					
	login_popup(beginsubscribe);
	
});

$("html").on("click", ".update_payment_method", function(e){
	e.stopPropagation();
	e.preventDefault();
	
	var currency = $(this).attr("currency");
		
	$.ajax({
		  type: 'POST',
		  url: "/update-payment-method",
		  data:  {currency: currency},
		  success: function(data){
			//console.log(data);
			var obj = JSON.parse(data);
			var sessionId = obj.sessionId;
			stripe
			  .redirectToCheckout({
				sessionId: sessionId
			  })
			  .then();
		  }
		});
});

  // pay with saved card
  $("html").on("click", ".confirmpayment", function(e){
	  
	  e.stopPropagation();
	  e.preventDefault();
	  
	  $(".progressbar").show();
	  
	  var thisbtn = $(this);
	  $(thisbtn).attr('disabled', true);
	  
	  //var plan_id = $(this).attr("plan-id");
	  var form = $(this).closest(".subscription_form");
	  var success_url = $(form).find(".success_redirect").val();

	  // after comfirmation
	  $.ajax({
		  type: 'POST',
		  url: "/another-subscription",
		  data: $(form).serialize(),
		  success: function(data){
			//console.log(data);
			var obj = JSON.parse(data);
			
			if(typeof obj.subscribed !== 'undefined' && obj.subscribed == 1){
				$(".progressbar").hide();
				M.toast({html: subscribed_already});
				return false;
			} else if(typeof obj.errormsg !== 'undefined' && obj.error == 1){
				$(".progressbar").hide();
				$(form).find(".errormsg").html(obj.errormsg);
				$(thisbtn).attr('disabled', false);
			} else {
				window.location.href = success_url;
				//location.reload();
			}
		  }
		});		  
  });
  
$('html,div').on('click', '.nocreditcard', function(e) {
	e.stopPropagation();
	e.preventDefault();
    $(this).closest("form").find(".paynoncard").show();
	$(this).closest("form").find(".paycard").hide();
});
$('html,div').on('click', '.yescreditcard', function(e) {
	e.stopPropagation();
	e.preventDefault();
    $(this).closest("form").find(".paycard").show();
	$(this).closest("form").find(".paynoncard").hide();
});

//phone number
$("html").on("click", ".plan_phone_number", function(e){
	
	 var thisbtn = $(this);
    var jointxt = $(thisbtn).html();
   
	var form = $(this).closest("form");
	
	if($(form).find('[name=contactnum]').val() == ''){
		$(form).find('.phoneremind').show();
		return false;
	}
      
	$.ajax({
	  type: 'POST',
	  url: "/process",
	  data: $(form).serialize(),
	  success: function(data){
		//console.log(data);
		var obj = JSON.parse(data);
		
		if(obj.notlogin == 1){
			login_popup();
			return false;
		} else if(obj.status == 'success'){
			//console.log("subscribed");
			$(thisbtn).closest(".paynoncard").html("You will be contacted shortly. Thank you!");
			return false;
		}
	  }
	});  
});

//payment
$("html").on("click", ".join_plan", function(e){
	e.preventDefault();
	e.stopPropagation();
	
   var thisbtn = $(this);
   var jointxt = $(thisbtn).html();
   
   var form = $(this).closest(".subscription_form");
   
  /*// newer syntax! 
    try {
		let dp = await getDefaultPayment();
		console.log('Data:', data);
	} catch (error) {
		console.log('Error:', error);
	}
  */
  
	if(!form[0].checkValidity()) {
	  // If the form is invalid, submit it. The form won't actually submit;
	  // this will just cause the browser to display the native HTML5 error messages.

		$(form).find(".shipping_address").show();

		if( !hasFormValidation() ) {
				// ios app fix (safari don;t respect required fields on submit)			
				var ref = $(form).find("[required]");

				$(ref).each(function(){
					if ( $(this).val() == '' )
					{
						$('.pseudotoast').addClass('toastontop').html("Required field should not be blank.").stop().fadeIn(400).delay(3000).fadeOut(400);	
						$(this).focus();
						e.preventDefault();
						return false;
					}
				}); 
				//alert("Required field should not be blank.");
				return false;
		}								
		
		$(form).find(':submit').click();						  
		
	} else {
		
	   var plan_id = $(form).find(".plan_id").val();
	   var plan_name = $(form).find(".plan_name").text();
	   
	   sendevent("pay", 'desktop_join_plan_step2', plan_name+" ("+plan_id+")");
	   gtag('event', 'conversion', { 'send_to': 'AW-882302996/RYviCNW0s7MDEJTA26QD', 'value': 1.0, 'currency': 'HKD' }); 
		
	  var currency = $(form).find(".plan_currency").val();
	   //loading
	   $(thisbtn).html($(form).find(".loader").html());   
		
	  // check default payment method first
	  getDefaultPayment(currency).then(function (dp) {
		  
		//console.log("result"+dp);
	  
		if(typeof dp !== 'undefined' && dp.length){ // hv saved payment method
		  
		  //console.log(dp);
		  var obj = JSON.parse(dp);
		  
		  var currency = obj.currency;
		  var last4 = obj.card['last4'];
		  var exp_month = obj.card['exp_month'];
		  var exp_year = obj.card['exp_year'];	  
		  var brand = obj.card['brand'];
			  brand = brand.toLowerCase();
		  
		  // TODO: ask to confirm , show last4
		  
		  var popup = $(thisbtn).closest(".subscription_form").find(".paywithsavedcard");
		  $(popup).find(".update_payment_method").attr("currency", currency);
		  $(popup).find(".last4").html(last4);
		  $(popup).find(".cardimage").attr("src", "https://static.penana.com/img/cards/dark/"+brand+".png");
		  $(thisbtn).hide();
		  $(popup).show();
		  var plan_id = $(form).find(".plan_id").val() // ??
		  $(popup).find(".confirmpayment").attr("plan-id", plan_id);	  
		  
		} else {	  // no saved payment method
				// Checkout
				
				//console.log("new customer");
				
				$.ajax({
				  type: 'POST',
				  url: "/create-subscription",
				  data: $(form).serialize(),
				  success: function(data){
					console.log(data);
					var obj = JSON.parse(data);
					
					if(obj.notlogin == 1){
						login_popup();
						return false;
					} else if(obj.subscribed == 1){
						//console.log("subscribed");
						$(thisbtn).html(subscribed_already);
						M.toast({html: subscribed_already});
						return false;
					}
					
					checkoutSessionId = obj.sessionId;
					
					// Initiate payment
					  stripe
						.redirectToCheckout({
						  sessionId: checkoutSessionId
						})
						.then(function(result) {
						  console.log("error");
						  // If `redirectToCheckout` fails due to a browser or network
						  // error, display the localized error message to your customer
						  // using `result.error.message`.
						})
						.catch(function(err) {
						  console.log(err);
						});
				  }
				});
		   }
			
		}); 
	}
});
  
 $('html,div').on('click', '.cancelpay', function(e){
	 e.preventDefault();
	 e.stopPropagation();
	 
	 var form = $(this).closest(".subscription_form");
	 var popup = $(form).find(".paywithsavedcard");
	 var joinplan = $(form).find(".join_plan");
	 $(popup).hide();
	 $(joinplan).show();
	 $(joinplan).html("Join");
	 $(form).find(".confirmpayment").attr("disabled", false);
	 $(".progressbar").hide();
 });
 
 $('html,div').on('click', '.langsetting', function(e){
	e.preventDefault();
	e.stopPropagation();
	var languagebox = $('.langpopup');
	login_popup(languagebox);
 });
 
 // page loading
 page = 2; timing = 'good';
 	
function gridLoader(pos){
	var loadinggrid = '<div class="valign-wrapper xbox loadinggrid"><div class="center width100"><img src="https://static2.penana.com/img/ajax-loader.gif"></div></div>';
	$(loadinggrid).appendTo(pos);
} 
 
function removeURLParameter(url, parameter) {
    //prefer to use l.search if you have a location/link object

	var prefix= encodeURIComponent(parameter)+'=';
	var pars= url.split(/[&;]/g);

	//reverse iteration as may be destructive
	for (var i= pars.length; i-- > 0;) {    
		//idiom for string.startsWith
		if (pars[i].lastIndexOf(prefix, 0) !== -1) {  
			pars.splice(i, 1);
		}
	}

	url= pars.join('&');
	return url;
}

function fixXBoxes(){
	$( ".xbox:not(.imgbox)" ).each(function() {
	  var thisheight = $(this).height();
	  $( this ).css( "height",  thisheight);
	});
}

function flowXBoxes(){
	$( ".xbox" ).each(function() {
	  $( this ).css( "height",  "auto");
	});
}

window.onresize = function(event) {
	$(".scroll_menu").trigger("custom-scroll");
    flowXBoxes();
	fixXBoxes();
};

var loadnewbox=null;	
function loadNewBoxes(pos, loadurl, additional_data){
	
	$(pos).html("");
	gridLoader(pos);
		
	if(loadurl.indexOf('?') > -1){
		var cancat = "&";		
	} else {
		var cancat = "?";	
	}
	
	var pathname = "/"+loadurl+cancat+"showbox=1&"+additional_data;		
			
	// abort previous unfinised process
	if (loadnewbox!=null){
		loadnewbox.abort();
	 }
	
	// load the content
	loadnewbox = $.get(pathname ,function(data){	
		//console.log(data);
		$(pos).find('.loadinggrid').remove();
		$(data).appendTo(pos);
		
		if (data.indexOf("no_result") >= 0){
			timing = 'bad';
		} else {
			timing = 'good';
			page = 2;
		}
		loadnewbox=null;
	});	
	
	//update url
	if(history.pushState){
		history.replaceState(null, null, window.location.pathname+"?"+additional_data);
	}
}

function loadMoreBoxes(pos, loadurl){
	
	gridLoader(pos);		
	
	//console.log(timing);
	if(timing == 'good'){
		timing = 'bad';
		//return false;		
		//var urldata = getStoryFiltersUrl();
		
		var urldata = window.location.search.slice(1);
			urldata = removeURLParameter(urldata, 'page');
			urldata = removeURLParameter(urldata, 'p');
			
		if(loadurl.indexOf('?') > -1){
			var cancat = "&";		
		} else {
			var cancat = "?";	
		}
		
		var additional_data = "";
		var data_addit = $(pos).attr("data-addit");
		if(typeof data_addit !== 'undefined' && data_addit !==0){
		  additional_data = "&"+data_addit;
		} 
			
		var pathname = "/"+loadurl+cancat+"showbox=1&"+urldata+"&page="+page+"&scroll=1"+additional_data;	
		//console.log(pathname);
		
		// load the content
		$.get(pathname ,function(data){			
				
			$(pos).find('.loadinggrid').remove();
			
			var loadafter = $(pos).attr("load-after");	
			if(typeof loadafter !== 'undefined' && loadafter !==0){
			  $(pos).after(data);
			} else {
			  $(data).appendTo(pos);
			}
			$(".scroll_menu").trigger("custom-scroll");
			setTimeout(function(){ $(".scroll_menu").trigger("custom-scroll"); }, 500);
			dragscroll.reset();
			
			if (data.indexOf("no_result") >= 0){
				timing = 'bad';
				//console.log("bad result");
			} else {
				timing = 'good';
				page = page+1;
				$(".loadnext").show();
				//console.log("good result");
			}
		});	
	}
}
		
// function to concate the params as get variables
function getStoryFiltersUrl(){
	
	var urldata = window.location.search.slice(1);
	
	dataarray = [],
	data = {},
	fdata = [],

	$('.storyfilter input[type="checkbox"],.storyfilter input[type="radio"], .storyfilter select option').each(function(i){
		
		var thisbtn = $(this);
						
		if(this.checked){
			if(!data.hasOwnProperty(this.name)){
				data[this.name] = [];
			}
			if(this.hasAttribute("dataname") && this.getAttribute("dataname")!=''){
				if(!data.hasOwnProperty(this.dataname)){
					data[this.getAttribute("dataname")] = []; //create 
				}
				data[this.getAttribute("dataname")].push(this.value);
			} else {					
				data[this.name].push(this.value);
			}			
		} else if(this.selected){
			console.log(this);
			var name = $(this).attr('name');
			 if(!data.hasOwnProperty(name)){
				data[name] = [];
			}
			data[name].push(this.value);
			$(thisbtn).closest('select').addClass('selected');
		} else if(this.type == 'checkbox' && !this.selected){
			// checkbox not checked
			var name = $(this).attr('name');
			data[name] = [];			
			data[name].push("");
		}
	});
	$.each(data, function(k, v){
		console.log(k);
		urldata = removeURLParameter(urldata, k);
		if(v != ""){
			dataarray.push(k+'='+v.join(','));
		}			
	});
	additional_params = dataarray.join('&');
	
	additional_params = additional_params.replace(/ /g, "+");
	
	//console.log(urldata);
	urldata = urldata+'&'+additional_params;
	
	return urldata;
}

$("html,div").on("click", ".expandclamp", function(e){
	e.preventDefault();
	e.stopPropagation();
	
	var targetdiv = $(this).attr("target-div");
	var hasnl2br = $(this).attr("nl2br");
	
	$("."+targetdiv).addClass("expand");
	$(this).hide();
	if(typeof hasnl2br != 'undefined' && hasnl2br == 1){
		$("."+targetdiv).html(nl2br($("."+targetdiv).html(), 1));
	}
});

function loadNext(){
  $(".loadnext").hide();
  var loadbox = $(".gridarea").attr("load-url");
  if(typeof loadbox == 'undefined' || loadbox == ""){
	  //
  } else{
	 loadMoreBoxes($(".xboxcontainer:last"), loadbox);	
  }
}

$("html,div").on("click", ".loadnext", function(e){
	e.stopPropagation();
	e.preventDefault();
	loadNext(); 
});

//infinite scroll
document.addEventListener('scroll', function(e) {
  if(timing == 'good'){
	if ($(window).scrollTop() >= $(document).height() - $(window).height() - 200 && page <= 50) {
		loadNext(); 
	};
  };	
});	 
	
$("div").on("click", ".scrolldown_pseudo", function(e){
	e.stopPropagation();
	e.preventDefault();
	var loadbox = $(".gridarea").attr("load-url");
	if(typeof loadbox == 'undefined' || loadbox == ""){
		  //
	} else{
		loadMoreBoxes($(".xboxcontainer:last"), loadbox);
	}
});

$('html,div').on('click', '.filterstorybtn', function(e){
	e.stopPropagation();
	login_popup($('.storyfilter'));
	// Select all select elements
	var elems = document.querySelectorAll('select');
  
	elems.forEach(elem => {
		// Check if the element already has an instance
		if (!elem.M_FormSelect) {
		// Initialize the select element if it doesn't have an instance
		M.FormSelect.init(elem, {
			// specify options here
		});
		}
	});
});

$("html,div").on("click", ".boxchange", function(e){
	e.preventDefault();
	e.stopPropagation();
	
	var param_name = $(this).attr("data-name");
	var param_val = $(this).attr("data-val");
		
	$(this).closest(".scroll_menu").find(".boxchange").removeClass("active");
	$(this).addClass("active");
	
	var showlist = $(this).closest(".listwrap").find(".showlist");
	$(showlist).addClass('loading');
	
	var data_id = $(showlist).attr('data-id');
	var list_type = $(showlist).attr('list-type');
	
	var pathname = "/loadscrolllist?id="+data_id+"&listtype="+list_type+"&"+param_name+"="+param_val;
	
	// load the content
	$.get(pathname ,function(data){
		$(showlist).html(data);
		$(showlist).removeClass('loading');
		$(".scroll_menu").trigger("custom-scroll");
	});			
});

$("html,div").on("click", ".bigboxchange", function(e){
	e.preventDefault();
	e.stopPropagation();
	
	var type = $(this).attr("data-type");
	var order = $(this).attr("data-order");	
	var param_name = $(this).attr("data-name");
	var param_val = $(this).attr("data-val");
	var option = $(this).attr("data-option");
	var option2 = $(this).attr("data-option2");
	var more_url = $(this).attr("data-more");
	
	$(this).closest(".scroll_menu").find(".bigboxchange").removeClass("active");
	$(this).addClass("active");
	
	var stories_wrap = $(this).closest(".stories_wrap");
	var showlist = $(stories_wrap).find(".newXboxWrap").first();
	$(showlist).addClass('loading');
	var pathname = "/load12boxes?type="+type+"&option="+option+"&order="+order+"&"+param_name+"="+param_val+"&option2="+option2;
	
	// load the content
	$.get(pathname ,function(data){
		$(showlist).html(data);
		$(showlist).removeClass('loading');
		$(".scroll_menu").trigger("custom-scroll");
		
		$(stories_wrap).find(".moreButton").attr("href", more_url);
	});			
});
 
$("html,div").on("click", ".gridfilter", function(e){
	e.preventDefault();
	e.stopPropagation();
	
	//console.log("click");
	
	$(this).closest(".filterwrap").find(".gridfilter").removeClass("active");
	$(this).addClass("active");
	
	var loadurl = $(this).closest(".filterwrap").attr("load-url");
	var param_name = $(this).attr("data-name");
	var param_val = $(this).attr("data-val");
	
	$(".subwrap").hide();
	$(".subwrap."+param_val.replace(/\W/g, '')).css('display', 'flex');
	$(this).closest(".subwrap").css('display', 'flex');
		
	var urldata = window.location.search.slice(1);
		urldata = removeURLParameter(urldata, param_name);			
		urldata = urldata+"&"+param_name+"="+param_val;
	
	var clearall = $(this).attr("clear-all");	
	if(typeof clearall !== 'undefined' && clearall !==0){
		$(".xboxcontainer").html("");
	}
	
	loadNewBoxes($(".xboxcontainer:first"), loadurl, urldata);
		
});

$('html,div').on('click', '.storyfilter .filter_apply', function(e){
	e.stopPropagation();
	
	$(this).closest('.popupwrap').find('.close').click();		
	
	var additional_filter = getStoryFiltersUrl();
	if(additional_filter !== ""){ // not empty filter
		$('.filterstorybtn').removeClass('grey-text').addClass('orange-text');			
	} else {
		$('.filterstorybtn').addClass('grey-text').removeClass('orange-text');			
	}
	
	var loadurl = $(this).closest(".filterwrap").attr("load-url");
	loadNewBoxes($(".xboxcontainer"), loadurl, additional_filter)
	
});
	
</script>
<div class="popupwrap displaynone langpopup">
<div class="mask pseudoclose"></div>
<div class="popup popupbox languagebox">
<a href="#" class="close closebtn">×</a>
<form action="/setting.php" method="post">
<h5 class="menuoptiontitle">Interface Language:</h5>
<div class="mpara mintro ">
<label for="en" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="radio" name="display_language" value="1" id="en" checked />
<span>English</span>
</label>
<label for="zh" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="radio" name="display_language" value="2" id="zh" />
<span>中文</span>
</label>
</div>
<h5 class="menuoptiontitle">Story Language:</h5>
<label for="stEnglish" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="English" id="stEnglish" checked />
<span>English</span>
</label>
<label for="stChinese" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="Chinese" id="stChinese" />
<span>Chinese (中文)</span>
</label>
<label for="stIndonesian" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="Indonesian" id="stIndonesian" />
<span>Indonesian (Bahasa Indonesia)</span>
</label>
<label for="stMalay" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="Malay" id="stMalay" />
<span>Malay (Bahasa Melayu)</span>
</label>
<label for="stTagalog" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="Tagalog" id="stTagalog" />
<span>Tagalog</span>
</label>
<label for="stVietnamese" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="Vietnamese" id="stVietnamese" />
<span>Vietnamese (tiếng Việt)</span>
</label>
<label for="stOther" tabindex="0" onkeypress="this.click()" class="displayblock menuoption">
<input class="language" type="checkbox" name="language[]" value="Other" id="stOther" />
<span>Other</span>
</label>
<input type="hidden" name="url" value="/terms" />
<p>
<button type="submit" class="submitbtn displayblock">Update</button>
</form>
</div>
</div>
<script>
	document.querySelectorAll('.materialize-textarea').forEach(function(element){
    M.Forms.InitTextarea(element);
});
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "http://www.penana.com/",
  "name" : "Penana",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "http://www.penana.com/search?search={search_term_string}&t=story",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script type="text/javascript">
  window._taboola = window._taboola || [];
  _taboola.push({flush: true});
</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'8c129cfe1ba34219',t:'MTcyNjAwNDgxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>